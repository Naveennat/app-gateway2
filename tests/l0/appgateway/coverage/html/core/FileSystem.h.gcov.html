<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - core/FileSystem.h</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="title">LCOV - code coverage report</td></tr>
            <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

            <tr>
              <td width="100%">
                <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="10%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">core</a> - FileSystem.h<span style="font-size: 80%;"> (source / <a href="FileSystem.h.func-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="5%"></td>
            <td width="5%" class="headerCovTableHead">Coverage</td>
            <td width="5%" class="headerCovTableHead" title="Covered + Uncovered code">Total</td>
            <td width="5%" class="headerCovTableHead" title="Exercised code only">Hit</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntryLo">0.0&nbsp;%</td>
            <td class="headerCovTableEntry">8</td>
            <td class="headerCovTableEntry">0</td>
          </tr>
          <tr>
            <td class="headerItem">Test Date:</td>
            <td class="headerValue">2026-01-07 12:20:23</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntryLo">0.0&nbsp;%</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">0</td>
          </tr>
                  <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
                </table>
              </td>
            </tr>

            <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
          </table>

          <table cellpadding=0 cellspacing=0 border=0>
            <tr>
              <td><br></td>
            </tr>
            <tr>
              <td>
<pre class="sourceHeading">            Line data    Source code</pre>
<pre class="source">
<span id="L1"><span class="lineNum">       1</span>              :  /*</span>
<span id="L2"><span class="lineNum">       2</span>              :  * If not stated otherwise in this file or this component's LICENSE file the</span>
<span id="L3"><span class="lineNum">       3</span>              :  * following copyright and licenses apply:</span>
<span id="L4"><span class="lineNum">       4</span>              :  *</span>
<span id="L5"><span class="lineNum">       5</span>              :  * Copyright 2020 Metrological</span>
<span id="L6"><span class="lineNum">       6</span>              :  *</span>
<span id="L7"><span class="lineNum">       7</span>              :  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span id="L8"><span class="lineNum">       8</span>              :  * you may not use this file except in compliance with the License.</span>
<span id="L9"><span class="lineNum">       9</span>              :  * You may obtain a copy of the License at</span>
<span id="L10"><span class="lineNum">      10</span>              :  *</span>
<span id="L11"><span class="lineNum">      11</span>              :  * http://www.apache.org/licenses/LICENSE-2.0</span>
<span id="L12"><span class="lineNum">      12</span>              :  *</span>
<span id="L13"><span class="lineNum">      13</span>              :  * Unless required by applicable law or agreed to in writing, software</span>
<span id="L14"><span class="lineNum">      14</span>              :  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span id="L15"><span class="lineNum">      15</span>              :  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span id="L16"><span class="lineNum">      16</span>              :  * See the License for the specific language governing permissions and</span>
<span id="L17"><span class="lineNum">      17</span>              :  * limitations under the License.</span>
<span id="L18"><span class="lineNum">      18</span>              :  */</span>
<span id="L19"><span class="lineNum">      19</span>              : </span>
<span id="L20"><span class="lineNum">      20</span>              : #ifndef __FILESYSTEM_H</span>
<span id="L21"><span class="lineNum">      21</span>              : #define __FILESYSTEM_H</span>
<span id="L22"><span class="lineNum">      22</span>              : </span>
<span id="L23"><span class="lineNum">      23</span>              : #include &quot;Portability.h&quot;</span>
<span id="L24"><span class="lineNum">      24</span>              : #include &quot;Number.h&quot;</span>
<span id="L25"><span class="lineNum">      25</span>              : #include &quot;Time.h&quot;</span>
<span id="L26"><span class="lineNum">      26</span>              : </span>
<span id="L27"><span class="lineNum">      27</span>              : #ifdef __POSIX__</span>
<span id="L28"><span class="lineNum">      28</span>              : #include &lt;sys/statvfs.h&gt;</span>
<span id="L29"><span class="lineNum">      29</span>              : #define INVALID_HANDLE_VALUE -1</span>
<span id="L30"><span class="lineNum">      30</span>              : #if defined(_LARGEFILE64_SOURCE) &amp;&amp; defined(_FILE_OFFSET_BITS) &amp;&amp; (_FILE_OFFSET_BITS == 64)</span>
<span id="L31"><span class="lineNum">      31</span>              : #define LSEEK lseek64</span>
<span id="L32"><span class="lineNum">      32</span>              : #else</span>
<span id="L33"><span class="lineNum">      33</span>              : #define LSEEK lseek</span>
<span id="L34"><span class="lineNum">      34</span>              : #endif</span>
<span id="L35"><span class="lineNum">      35</span>              : #endif</span>
<span id="L36"><span class="lineNum">      36</span>              : </span>
<span id="L37"><span class="lineNum">      37</span>              : namespace WPEFramework {</span>
<span id="L38"><span class="lineNum">      38</span>              : namespace Core {</span>
<span id="L39"><span class="lineNum">      39</span>              : </span>
<span id="L40"><span class="lineNum">      40</span>              :     PUSH_WARNING(DISABLE_WARNING_UNUSED_FUNCTIONS)</span>
<span id="L41"><span class="lineNum">      41</span>              : </span>
<span id="L42"><span class="lineNum">      42</span> <span class="tlaUNC tlaBgUNC">           0 :     static void ParsePathInfo(const string&amp; pathInfo, string&amp; path, uint16_t&amp; permission)</span></span>
<span id="L43"><span class="lineNum">      43</span>              :     {</span>
<span id="L44"><span class="lineNum">      44</span> <span class="tlaUNC">           0 :         size_t position = pathInfo.find(&quot;|&quot;);</span></span>
<span id="L45"><span class="lineNum">      45</span> <span class="tlaUNC">           0 :         if (position != string::npos) {</span></span>
<span id="L46"><span class="lineNum">      46</span> <span class="tlaUNC">           0 :             Core::NumberType&lt;uint16_t&gt; number(pathInfo.substr(position + 1).c_str(), static_cast&lt;uint32_t&gt;(pathInfo.length() - position));</span></span>
<span id="L47"><span class="lineNum">      47</span> <span class="tlaUNC">           0 :             permission = number.Value();</span></span>
<span id="L48"><span class="lineNum">      48</span> <span class="tlaUNC">           0 :         }</span></span>
<span id="L49"><span class="lineNum">      49</span> <span class="tlaUNC">           0 :         path = pathInfo.substr(0, position);</span></span>
<span id="L50"><span class="lineNum">      50</span> <span class="tlaUNC">           0 :     }</span></span>
<span id="L51"><span class="lineNum">      51</span>              : </span>
<span id="L52"><span class="lineNum">      52</span>              :     POP_WARNING()</span>
<span id="L53"><span class="lineNum">      53</span>              : </span>
<span id="L54"><span class="lineNum">      54</span>              :     class EXTERNAL File {</span>
<span id="L55"><span class="lineNum">      55</span>              :     public:</span>
<span id="L56"><span class="lineNum">      56</span>              : #ifdef __WINDOWS__</span>
<span id="L57"><span class="lineNum">      57</span>              :         typedef enum {</span>
<span id="L58"><span class="lineNum">      58</span>              :             // A file that is read-only. Applications can read the file, but cannot write to it or delete it. This attribute is not honored on directories. For more information, see You cannot view or change the Read-only or the System attributes of folders in Windows Server 2003, in Windows XP, in Windows Vista or in Windows 7.</span>
<span id="L59"><span class="lineNum">      59</span>              :             FILE_READONLY = FILE_ATTRIBUTE_READONLY,</span>
<span id="L60"><span class="lineNum">      60</span>              :             // The file or directory is hidden. It is not included in an ordinary directory listing.</span>
<span id="L61"><span class="lineNum">      61</span>              :             FILE_HIDDEN = FILE_ATTRIBUTE_HIDDEN,</span>
<span id="L62"><span class="lineNum">      62</span>              :             // A file or directory that the operating system uses a part of, or uses exclusively.</span>
<span id="L63"><span class="lineNum">      63</span>              :             FILE_SYSTEM = FILE_ATTRIBUTE_SYSTEM,</span>
<span id="L64"><span class="lineNum">      64</span>              :             // The handle that identifies a directory.</span>
<span id="L65"><span class="lineNum">      65</span>              :             FILE_DIRECTORY = FILE_ATTRIBUTE_DIRECTORY,</span>
<span id="L66"><span class="lineNum">      66</span>              :             // A file or directory that is an archive file or directory. Applications typically use this attribute to mark files for backup or removal .</span>
<span id="L67"><span class="lineNum">      67</span>              :             FILE_ARCHIVE = FILE_ATTRIBUTE_ARCHIVE,</span>
<span id="L68"><span class="lineNum">      68</span>              :             // This value is reserved for system use.</span>
<span id="L69"><span class="lineNum">      69</span>              :             FILE_NORMAL = FILE_ATTRIBUTE_NORMAL,</span>
<span id="L70"><span class="lineNum">      70</span>              :             // A file or directory that has an associated reparse point, or a file that is a symbolic link.</span>
<span id="L71"><span class="lineNum">      71</span>              :             FILE_LINK = FILE_ATTRIBUTE_REPARSE_POINT,</span>
<span id="L72"><span class="lineNum">      72</span>              :             // A file or directory that is compressed. For a file, all of the data in the file is compressed. For a directory, compression is the default for newly created files and subdirectories.</span>
<span id="L73"><span class="lineNum">      73</span>              :             FILE_COMPRESSED = FILE_ATTRIBUTE_COMPRESSED,</span>
<span id="L74"><span class="lineNum">      74</span>              :             // A file or directory that is encrypted. For a file, all data streams in the file are encrypted. For a directory, encryption is the default for newly created files and subdirectories.</span>
<span id="L75"><span class="lineNum">      75</span>              :             FILE_ENCRYPTED = FILE_ATTRIBUTE_ENCRYPTED</span>
<span id="L76"><span class="lineNum">      76</span>              : </span>
<span id="L77"><span class="lineNum">      77</span>              :         } Atrributes;</span>
<span id="L78"><span class="lineNum">      78</span>              : </span>
<span id="L79"><span class="lineNum">      79</span>              :         typedef enum : uint32_t {</span>
<span id="L80"><span class="lineNum">      80</span>              :             USER_READ      = 0x00000001,</span>
<span id="L81"><span class="lineNum">      81</span>              :             USER_WRITE     = 0x00000002,</span>
<span id="L82"><span class="lineNum">      82</span>              :             USER_EXECUTE   = 0x00000004,</span>
<span id="L83"><span class="lineNum">      83</span>              :             GROUP_READ     = 0x00000008,</span>
<span id="L84"><span class="lineNum">      84</span>              :             GROUP_WRITE    = 0x00000010,</span>
<span id="L85"><span class="lineNum">      85</span>              :             GROUP_EXECUTE  = 0x00000020,</span>
<span id="L86"><span class="lineNum">      86</span>              :             OTHERS_READ    = 0x00000040,</span>
<span id="L87"><span class="lineNum">      87</span>              :             OTHERS_WRITE   = 0x00000080,</span>
<span id="L88"><span class="lineNum">      88</span>              :             OTHERS_EXECUTE = 0x00000100,</span>
<span id="L89"><span class="lineNum">      89</span>              :             SHAREABLE      = 0x10000000,</span>
<span id="L90"><span class="lineNum">      90</span>              :             CREATE         = 0x20000000</span>
<span id="L91"><span class="lineNum">      91</span>              :        } Mode;</span>
<span id="L92"><span class="lineNum">      92</span>              : </span>
<span id="L93"><span class="lineNum">      93</span>              : #endif</span>
<span id="L94"><span class="lineNum">      94</span>              : </span>
<span id="L95"><span class="lineNum">      95</span>              : #ifdef __POSIX__</span>
<span id="L96"><span class="lineNum">      96</span>              :         typedef enum {</span>
<span id="L97"><span class="lineNum">      97</span>              :             // A file or directory that the operating system uses a part of, or uses exclusively.</span>
<span id="L98"><span class="lineNum">      98</span>              :             FILE_SYSTEM = 0x0001,</span>
<span id="L99"><span class="lineNum">      99</span>              :             // The handle that identifies a directory.</span>
<span id="L100"><span class="lineNum">     100</span>              :             FILE_DIRECTORY = S_IFDIR,</span>
<span id="L101"><span class="lineNum">     101</span>              :             // A file that is read-only. Applications can read the file, but cannot write to it or delete it. This attribute is not honored on directories. For more information, see You cannot view or change the Read-only or the System attributes of folders in Windows Server 2003, in Windows XP, in Windows Vista or in Windows 7.</span>
<span id="L102"><span class="lineNum">     102</span>              :             FILE_READONLY = 0x0002,</span>
<span id="L103"><span class="lineNum">     103</span>              :             // The file or directory is hidden. It is not included in an ordinary directory listing.</span>
<span id="L104"><span class="lineNum">     104</span>              :             FILE_HIDDEN = 0x0004,</span>
<span id="L105"><span class="lineNum">     105</span>              :             // A file or directory that is an archive file or directory. Applications typically use this attribute to mark files for backup or removal .</span>
<span id="L106"><span class="lineNum">     106</span>              :             FILE_ARCHIVE = 0x0008,</span>
<span id="L107"><span class="lineNum">     107</span>              :             // A file that does not have other attributes set. This attribute is valid only when used alone.</span>
<span id="L108"><span class="lineNum">     108</span>              :             FILE_NORMAL = S_IFREG,</span>
<span id="L109"><span class="lineNum">     109</span>              :             // A file or directory that has an associated reparse point, or a file that is a symbolic link.</span>
<span id="L110"><span class="lineNum">     110</span>              :             FILE_LINK = S_IFLNK,</span>
<span id="L111"><span class="lineNum">     111</span>              :             // A device</span>
<span id="L112"><span class="lineNum">     112</span>              :             FILE_DEVICE = 0x0010</span>
<span id="L113"><span class="lineNum">     113</span>              :         } Atrributes;</span>
<span id="L114"><span class="lineNum">     114</span>              : </span>
<span id="L115"><span class="lineNum">     115</span>              :         typedef enum : uint32_t {</span>
<span id="L116"><span class="lineNum">     116</span>              :             USER_READ      = S_IRUSR,</span>
<span id="L117"><span class="lineNum">     117</span>              :             USER_WRITE     = S_IWUSR,</span>
<span id="L118"><span class="lineNum">     118</span>              :             USER_EXECUTE   = S_IXUSR,</span>
<span id="L119"><span class="lineNum">     119</span>              :             GROUP_READ     = S_IRGRP,</span>
<span id="L120"><span class="lineNum">     120</span>              :             GROUP_WRITE    = S_IWGRP,</span>
<span id="L121"><span class="lineNum">     121</span>              :             GROUP_EXECUTE  = S_IXGRP,</span>
<span id="L122"><span class="lineNum">     122</span>              :             OTHERS_READ    = S_IROTH,</span>
<span id="L123"><span class="lineNum">     123</span>              :             OTHERS_WRITE   = S_IWOTH,</span>
<span id="L124"><span class="lineNum">     124</span>              :             OTHERS_EXECUTE = S_IXOTH,</span>
<span id="L125"><span class="lineNum">     125</span>              :             SHAREABLE      = 0x10000000,</span>
<span id="L126"><span class="lineNum">     126</span>              :             CREATE         = 0x20000000</span>
<span id="L127"><span class="lineNum">     127</span>              :        } Mode;</span>
<span id="L128"><span class="lineNum">     128</span>              : </span>
<span id="L129"><span class="lineNum">     129</span>              : </span>
<span id="L130"><span class="lineNum">     130</span>              : #endif</span>
<span id="L131"><span class="lineNum">     131</span>              : </span>
<span id="L132"><span class="lineNum">     132</span>              :     public:</span>
<span id="L133"><span class="lineNum">     133</span>              : #ifdef __POSIX__</span>
<span id="L134"><span class="lineNum">     134</span>              :         typedef int Handle;</span>
<span id="L135"><span class="lineNum">     135</span>              : #endif</span>
<span id="L136"><span class="lineNum">     136</span>              : #ifdef __WINDOWS__</span>
<span id="L137"><span class="lineNum">     137</span>              :         typedef HANDLE Handle;</span>
<span id="L138"><span class="lineNum">     138</span>              : #endif</span>
<span id="L139"><span class="lineNum">     139</span>              : </span>
<span id="L140"><span class="lineNum">     140</span>              :     public:</span>
<span id="L141"><span class="lineNum">     141</span>              :         explicit File();</span>
<span id="L142"><span class="lineNum">     142</span>              :         explicit File(const string&amp; fileName);</span>
<span id="L143"><span class="lineNum">     143</span>              :         explicit File(const File&amp; copy);</span>
<span id="L144"><span class="lineNum">     144</span>              :         ~File();</span>
<span id="L145"><span class="lineNum">     145</span>              : </span>
<span id="L146"><span class="lineNum">     146</span>              :         File&amp; operator=(const string&amp; location)</span>
<span id="L147"><span class="lineNum">     147</span>              :         {</span>
<span id="L148"><span class="lineNum">     148</span>              :             _name = location;</span>
<span id="L149"><span class="lineNum">     149</span>              :             LoadFileInfo();</span>
<span id="L150"><span class="lineNum">     150</span>              : </span>
<span id="L151"><span class="lineNum">     151</span>              :             return (*this);</span>
<span id="L152"><span class="lineNum">     152</span>              :         }</span>
<span id="L153"><span class="lineNum">     153</span>              :         File&amp; operator=(const File&amp; RHS)</span>
<span id="L154"><span class="lineNum">     154</span>              :         {</span>
<span id="L155"><span class="lineNum">     155</span>              :             _name = RHS._name;</span>
<span id="L156"><span class="lineNum">     156</span>              :             _size = RHS._size;</span>
<span id="L157"><span class="lineNum">     157</span>              :             _attributes = RHS._attributes;</span>
<span id="L158"><span class="lineNum">     158</span>              :             _creation = RHS._creation;</span>
<span id="L159"><span class="lineNum">     159</span>              :             _modification = RHS._modification;</span>
<span id="L160"><span class="lineNum">     160</span>              :             _access = RHS._access;</span>
<span id="L161"><span class="lineNum">     161</span>              : </span>
<span id="L162"><span class="lineNum">     162</span>              :             if (_handle != INVALID_HANDLE_VALUE) {</span>
<span id="L163"><span class="lineNum">     163</span>              : #ifdef __POSIX__</span>
<span id="L164"><span class="lineNum">     164</span>              :                 close(_handle);</span>
<span id="L165"><span class="lineNum">     165</span>              : #else</span>
<span id="L166"><span class="lineNum">     166</span>              :                 ::CloseHandle(_handle);</span>
<span id="L167"><span class="lineNum">     167</span>              : #endif</span>
<span id="L168"><span class="lineNum">     168</span>              :             }</span>
<span id="L169"><span class="lineNum">     169</span>              : </span>
<span id="L170"><span class="lineNum">     170</span>              :             _handle = RHS.DuplicateHandle();</span>
<span id="L171"><span class="lineNum">     171</span>              : </span>
<span id="L172"><span class="lineNum">     172</span>              :             return (*this);</span>
<span id="L173"><span class="lineNum">     173</span>              :         }</span>
<span id="L174"><span class="lineNum">     174</span>              : </span>
<span id="L175"><span class="lineNum">     175</span>              :         static string Normalize(const string&amp; input, bool&amp; valid);</span>
<span id="L176"><span class="lineNum">     176</span>              : </span>
<span id="L177"><span class="lineNum">     177</span>              :     public:</span>
<span id="L178"><span class="lineNum">     178</span>              :         inline static string FileName(const string&amp; name)</span>
<span id="L179"><span class="lineNum">     179</span>              :         {</span>
<span id="L180"><span class="lineNum">     180</span>              :             uint32_t filenameOffset = FileNameOffset(name);</span>
<span id="L181"><span class="lineNum">     181</span>              :             uint32_t offset = ExtensionOffset(name);</span>
<span id="L182"><span class="lineNum">     182</span>              :             int value = (offset &gt;= (filenameOffset + 2) ? (offset - 1 - filenameOffset) : -1);</span>
<span id="L183"><span class="lineNum">     183</span>              : </span>
<span id="L184"><span class="lineNum">     184</span>              :             return (name.substr(filenameOffset, value));</span>
<span id="L185"><span class="lineNum">     185</span>              :         }</span>
<span id="L186"><span class="lineNum">     186</span>              :         inline static string FileNameExtended(const string&amp; name)</span>
<span id="L187"><span class="lineNum">     187</span>              :         {</span>
<span id="L188"><span class="lineNum">     188</span>              :             return (name.substr(FileNameOffset(name), -1));</span>
<span id="L189"><span class="lineNum">     189</span>              :         }</span>
<span id="L190"><span class="lineNum">     190</span>              :         inline static string PathName(const string&amp; name)</span>
<span id="L191"><span class="lineNum">     191</span>              :         {</span>
<span id="L192"><span class="lineNum">     192</span>              :             string result;</span>
<span id="L193"><span class="lineNum">     193</span>              :             uint32_t offset = FileNameOffset(name);</span>
<span id="L194"><span class="lineNum">     194</span>              : </span>
<span id="L195"><span class="lineNum">     195</span>              :             if (offset != 0) {</span>
<span id="L196"><span class="lineNum">     196</span>              :                 result = name.substr(0, offset);</span>
<span id="L197"><span class="lineNum">     197</span>              :             }</span>
<span id="L198"><span class="lineNum">     198</span>              : </span>
<span id="L199"><span class="lineNum">     199</span>              :             return (result);</span>
<span id="L200"><span class="lineNum">     200</span>              :         }</span>
<span id="L201"><span class="lineNum">     201</span>              :         inline static string Extension(const string&amp; name)</span>
<span id="L202"><span class="lineNum">     202</span>              :         {</span>
<span id="L203"><span class="lineNum">     203</span>              :             string result;</span>
<span id="L204"><span class="lineNum">     204</span>              :             uint32_t offset = ExtensionOffset(name);</span>
<span id="L205"><span class="lineNum">     205</span>              : </span>
<span id="L206"><span class="lineNum">     206</span>              :             if (offset != 0) {</span>
<span id="L207"><span class="lineNum">     207</span>              :                 result = name.substr(offset, -1);</span>
<span id="L208"><span class="lineNum">     208</span>              :             }</span>
<span id="L209"><span class="lineNum">     209</span>              : </span>
<span id="L210"><span class="lineNum">     210</span>              :             return (result);</span>
<span id="L211"><span class="lineNum">     211</span>              :         }</span>
<span id="L212"><span class="lineNum">     212</span>              :         inline uint32_t ErrorCode() const</span>
<span id="L213"><span class="lineNum">     213</span>              :         {</span>
<span id="L214"><span class="lineNum">     214</span>              : #ifdef __WINDOWS__</span>
<span id="L215"><span class="lineNum">     215</span>              :             return (static_cast&lt;uint32_t&gt;(::GetLastError()));</span>
<span id="L216"><span class="lineNum">     216</span>              : #endif</span>
<span id="L217"><span class="lineNum">     217</span>              : #ifdef __POSIX__</span>
<span id="L218"><span class="lineNum">     218</span>              :             return (static_cast&lt;uint32_t&gt;(errno));</span>
<span id="L219"><span class="lineNum">     219</span>              : #endif</span>
<span id="L220"><span class="lineNum">     220</span>              :         }</span>
<span id="L221"><span class="lineNum">     221</span>              :         inline bool IsOpen() const</span>
<span id="L222"><span class="lineNum">     222</span>              :         {</span>
<span id="L223"><span class="lineNum">     223</span>              :             return (_handle != INVALID_HANDLE_VALUE);</span>
<span id="L224"><span class="lineNum">     224</span>              :         }</span>
<span id="L225"><span class="lineNum">     225</span>              :         inline bool Exists() const</span>
<span id="L226"><span class="lineNum">     226</span>              :         {</span>
<span id="L227"><span class="lineNum">     227</span>              :             return (_attributes != 0);</span>
<span id="L228"><span class="lineNum">     228</span>              :         }</span>
<span id="L229"><span class="lineNum">     229</span>              :         inline bool IsReadOnly() const</span>
<span id="L230"><span class="lineNum">     230</span>              :         {</span>
<span id="L231"><span class="lineNum">     231</span>              :             return ((_attributes &amp; FILE_READONLY) != 0);</span>
<span id="L232"><span class="lineNum">     232</span>              :         }</span>
<span id="L233"><span class="lineNum">     233</span>              :         inline bool IsHidden() const</span>
<span id="L234"><span class="lineNum">     234</span>              :         {</span>
<span id="L235"><span class="lineNum">     235</span>              :             return ((_attributes &amp; FILE_HIDDEN) != 0);</span>
<span id="L236"><span class="lineNum">     236</span>              :         }</span>
<span id="L237"><span class="lineNum">     237</span>              :         inline bool IsSystem() const</span>
<span id="L238"><span class="lineNum">     238</span>              :         {</span>
<span id="L239"><span class="lineNum">     239</span>              :             return ((_attributes &amp; FILE_SYSTEM) != 0);</span>
<span id="L240"><span class="lineNum">     240</span>              :         }</span>
<span id="L241"><span class="lineNum">     241</span>              :         inline bool IsArchive() const</span>
<span id="L242"><span class="lineNum">     242</span>              :         {</span>
<span id="L243"><span class="lineNum">     243</span>              :             return ((_attributes &amp; FILE_ARCHIVE) != 0);</span>
<span id="L244"><span class="lineNum">     244</span>              :         }</span>
<span id="L245"><span class="lineNum">     245</span>              :         inline bool IsDirectory() const</span>
<span id="L246"><span class="lineNum">     246</span>              :         {</span>
<span id="L247"><span class="lineNum">     247</span>              :             return ((_attributes &amp; FILE_DIRECTORY) == FILE_DIRECTORY);</span>
<span id="L248"><span class="lineNum">     248</span>              :         }</span>
<span id="L249"><span class="lineNum">     249</span>              :         inline bool IsLink() const</span>
<span id="L250"><span class="lineNum">     250</span>              :         {</span>
<span id="L251"><span class="lineNum">     251</span>              :             return ((_attributes &amp; FILE_LINK) == FILE_LINK);</span>
<span id="L252"><span class="lineNum">     252</span>              :         }</span>
<span id="L253"><span class="lineNum">     253</span>              :         inline bool IsCompressed() const</span>
<span id="L254"><span class="lineNum">     254</span>              :         {</span>
<span id="L255"><span class="lineNum">     255</span>              : #ifdef __POSIX__</span>
<span id="L256"><span class="lineNum">     256</span>              :             return (false);</span>
<span id="L257"><span class="lineNum">     257</span>              : #endif</span>
<span id="L258"><span class="lineNum">     258</span>              : #ifdef __WINDOWS__</span>
<span id="L259"><span class="lineNum">     259</span>              :             return ((_attributes &amp; FILE_COMPRESSED) != 0);</span>
<span id="L260"><span class="lineNum">     260</span>              : #endif</span>
<span id="L261"><span class="lineNum">     261</span>              :         }</span>
<span id="L262"><span class="lineNum">     262</span>              :         inline bool IsEncrypted() const</span>
<span id="L263"><span class="lineNum">     263</span>              :         {</span>
<span id="L264"><span class="lineNum">     264</span>              : #ifdef __POSIX__</span>
<span id="L265"><span class="lineNum">     265</span>              :             return (false);</span>
<span id="L266"><span class="lineNum">     266</span>              : #endif</span>
<span id="L267"><span class="lineNum">     267</span>              : #ifdef __WINDOWS__</span>
<span id="L268"><span class="lineNum">     268</span>              :             return ((_attributes &amp; FILE_ENCRYPTED) != 0);</span>
<span id="L269"><span class="lineNum">     269</span>              : #endif</span>
<span id="L270"><span class="lineNum">     270</span>              :         }</span>
<span id="L271"><span class="lineNum">     271</span>              :         inline const string&amp; Name() const</span>
<span id="L272"><span class="lineNum">     272</span>              :         {</span>
<span id="L273"><span class="lineNum">     273</span>              :             return (_name);</span>
<span id="L274"><span class="lineNum">     274</span>              :         }</span>
<span id="L275"><span class="lineNum">     275</span>              :         inline string PathName() const</span>
<span id="L276"><span class="lineNum">     276</span>              :         {</span>
<span id="L277"><span class="lineNum">     277</span>              :             return (PathName(_name));</span>
<span id="L278"><span class="lineNum">     278</span>              :         }</span>
<span id="L279"><span class="lineNum">     279</span>              :         inline string FileName() const</span>
<span id="L280"><span class="lineNum">     280</span>              :         {</span>
<span id="L281"><span class="lineNum">     281</span>              :             return (FileName(_name));</span>
<span id="L282"><span class="lineNum">     282</span>              :         }</span>
<span id="L283"><span class="lineNum">     283</span>              :         inline string FileNameExtended() const</span>
<span id="L284"><span class="lineNum">     284</span>              :         {</span>
<span id="L285"><span class="lineNum">     285</span>              :             return (FileNameExtended(_name));</span>
<span id="L286"><span class="lineNum">     286</span>              :         }</span>
<span id="L287"><span class="lineNum">     287</span>              :         inline string Extension() const</span>
<span id="L288"><span class="lineNum">     288</span>              :         {</span>
<span id="L289"><span class="lineNum">     289</span>              :             return (Extension(_name));</span>
<span id="L290"><span class="lineNum">     290</span>              :         }</span>
<span id="L291"><span class="lineNum">     291</span>              :         inline Core::Time ModificationTime() const</span>
<span id="L292"><span class="lineNum">     292</span>              :         {</span>
<span id="L293"><span class="lineNum">     293</span>              :             return (_modification);</span>
<span id="L294"><span class="lineNum">     294</span>              :         }</span>
<span id="L295"><span class="lineNum">     295</span>              :         inline Core::Time AccessTime() const</span>
<span id="L296"><span class="lineNum">     296</span>              :         {</span>
<span id="L297"><span class="lineNum">     297</span>              :             return (_access);</span>
<span id="L298"><span class="lineNum">     298</span>              :         }</span>
<span id="L299"><span class="lineNum">     299</span>              :         inline Core::Time CreationTime() const</span>
<span id="L300"><span class="lineNum">     300</span>              :         {</span>
<span id="L301"><span class="lineNum">     301</span>              :             return (_creation);</span>
<span id="L302"><span class="lineNum">     302</span>              :         }</span>
<span id="L303"><span class="lineNum">     303</span>              :         inline uint64_t Size() const</span>
<span id="L304"><span class="lineNum">     304</span>              :         {</span>
<span id="L305"><span class="lineNum">     305</span>              :             return (_size);</span>
<span id="L306"><span class="lineNum">     306</span>              :         }</span>
<span id="L307"><span class="lineNum">     307</span>              :         bool SetSize(const uint64_t size)</span>
<span id="L308"><span class="lineNum">     308</span>              :         {</span>
<span id="L309"><span class="lineNum">     309</span>              :             bool result;</span>
<span id="L310"><span class="lineNum">     310</span>              : #ifdef __WINDOWS__</span>
<span id="L311"><span class="lineNum">     311</span>              :             LARGE_INTEGER position;</span>
<span id="L312"><span class="lineNum">     312</span>              :             position.HighPart = (size &gt;&gt; 32);</span>
<span id="L313"><span class="lineNum">     313</span>              :             position.LowPart = (size &amp; 0xFFFFFFFF);</span>
<span id="L314"><span class="lineNum">     314</span>              :             result = (SetFilePointerEx(_handle, position, nullptr, FILE_BEGIN) != 0);</span>
<span id="L315"><span class="lineNum">     315</span>              : #else</span>
<span id="L316"><span class="lineNum">     316</span>              :             result = (ftruncate(_handle, size) != -1);</span>
<span id="L317"><span class="lineNum">     317</span>              : #endif</span>
<span id="L318"><span class="lineNum">     318</span>              : </span>
<span id="L319"><span class="lineNum">     319</span>              :             LoadFileInfo();</span>
<span id="L320"><span class="lineNum">     320</span>              : </span>
<span id="L321"><span class="lineNum">     321</span>              :             return (result);</span>
<span id="L322"><span class="lineNum">     322</span>              :         }</span>
<span id="L323"><span class="lineNum">     323</span>              : </span>
<span id="L324"><span class="lineNum">     324</span>              :         bool Link(const string&amp; symlinkName)</span>
<span id="L325"><span class="lineNum">     325</span>              :         {</span>
<span id="L326"><span class="lineNum">     326</span>              : #ifdef __WINDOWS__</span>
<span id="L327"><span class="lineNum">     327</span>              :             return (::CreateSymbolicLink(symlinkName.c_str(), _name.c_str(), (IsDirectory() ? SYMBOLIC_LINK_FLAG_DIRECTORY : 0)) != FALSE);</span>
<span id="L328"><span class="lineNum">     328</span>              : #else</span>
<span id="L329"><span class="lineNum">     329</span>              :             return (symlink(_name.c_str(), symlinkName.c_str()) &gt;= 0);</span>
<span id="L330"><span class="lineNum">     330</span>              : #endif</span>
<span id="L331"><span class="lineNum">     331</span>              :         }</span>
<span id="L332"><span class="lineNum">     332</span>              : </span>
<span id="L333"><span class="lineNum">     333</span>              :         bool Create(const bool exclusive = false)</span>
<span id="L334"><span class="lineNum">     334</span>              :         {</span>
<span id="L335"><span class="lineNum">     335</span>              :             return (Create((USER_READ|USER_WRITE|USER_EXECUTE|GROUP_READ|GROUP_EXECUTE), exclusive));</span>
<span id="L336"><span class="lineNum">     336</span>              :         }</span>
<span id="L337"><span class="lineNum">     337</span>              : </span>
<span id="L338"><span class="lineNum">     338</span>              :         bool Create(const uint32_t mode, const bool exclusive = false)</span>
<span id="L339"><span class="lineNum">     339</span>              :         {</span>
<span id="L340"><span class="lineNum">     340</span>              : #ifdef __POSIX__</span>
<span id="L341"><span class="lineNum">     341</span>              :             _handle = open(_name.c_str(), O_CLOEXEC | O_RDWR | O_CREAT | O_TRUNC | (exclusive ? O_EXCL : 0), mode);</span>
<span id="L342"><span class="lineNum">     342</span>              : #endif</span>
<span id="L343"><span class="lineNum">     343</span>              : #ifdef __WINDOWS__</span>
<span id="L344"><span class="lineNum">     344</span>              :             _handle = ::CreateFile(_name.c_str(), (GENERIC_READ | GENERIC_WRITE), (exclusive ? 0 : (FILE_SHARE_READ | FILE_SHARE_WRITE)), nullptr, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, nullptr);</span>
<span id="L345"><span class="lineNum">     345</span>              : #endif</span>
<span id="L346"><span class="lineNum">     346</span>              :             LoadFileInfo();</span>
<span id="L347"><span class="lineNum">     347</span>              :             return (IsOpen());</span>
<span id="L348"><span class="lineNum">     348</span>              :         }</span>
<span id="L349"><span class="lineNum">     349</span>              : </span>
<span id="L350"><span class="lineNum">     350</span>              :         bool Open() const</span>
<span id="L351"><span class="lineNum">     351</span>              :         {</span>
<span id="L352"><span class="lineNum">     352</span>              : #ifdef __POSIX__</span>
<span id="L353"><span class="lineNum">     353</span>              :             _handle = open(_name.c_str(), O_RDONLY | O_CLOEXEC);</span>
<span id="L354"><span class="lineNum">     354</span>              : #endif</span>
<span id="L355"><span class="lineNum">     355</span>              : #ifdef __WINDOWS__</span>
<span id="L356"><span class="lineNum">     356</span>              :             _handle = ::CreateFile(_name.c_str(), GENERIC_READ, 0, nullptr, OPEN_EXISTING, FILE_ATTRIBUTE_READONLY, nullptr);</span>
<span id="L357"><span class="lineNum">     357</span>              : #endif</span>
<span id="L358"><span class="lineNum">     358</span>              :             const_cast&lt;File*&gt;(this)-&gt;LoadFileInfo();</span>
<span id="L359"><span class="lineNum">     359</span>              :             return (IsOpen());</span>
<span id="L360"><span class="lineNum">     360</span>              :         }</span>
<span id="L361"><span class="lineNum">     361</span>              :         bool Open(bool readOnly)</span>
<span id="L362"><span class="lineNum">     362</span>              :         {</span>
<span id="L363"><span class="lineNum">     363</span>              : #ifdef __POSIX__</span>
<span id="L364"><span class="lineNum">     364</span>              :             _handle = open(_name.c_str(), O_CLOEXEC | (readOnly ? O_RDONLY : O_RDWR));</span>
<span id="L365"><span class="lineNum">     365</span>              : #endif</span>
<span id="L366"><span class="lineNum">     366</span>              : #ifdef __WINDOWS__</span>
<span id="L367"><span class="lineNum">     367</span>              :             _handle = ::CreateFile(_name.c_str(), GENERIC_READ | (readOnly ? 0 : GENERIC_WRITE), FILE_SHARE_READ | (readOnly ? 0 : FILE_SHARE_WRITE), nullptr, OPEN_EXISTING, (readOnly ? FILE_ATTRIBUTE_READONLY : FILE_ATTRIBUTE_NORMAL), nullptr);</span>
<span id="L368"><span class="lineNum">     368</span>              : #endif</span>
<span id="L369"><span class="lineNum">     369</span>              :             LoadFileInfo();</span>
<span id="L370"><span class="lineNum">     370</span>              :             return (IsOpen());</span>
<span id="L371"><span class="lineNum">     371</span>              :         }</span>
<span id="L372"><span class="lineNum">     372</span>              :         bool Append()</span>
<span id="L373"><span class="lineNum">     373</span>              :         {</span>
<span id="L374"><span class="lineNum">     374</span>              : #ifdef __POSIX__</span>
<span id="L375"><span class="lineNum">     375</span>              :             _handle = open(_name.c_str(), O_CLOEXEC| O_RDWR | O_APPEND);</span>
<span id="L376"><span class="lineNum">     376</span>              : </span>
<span id="L377"><span class="lineNum">     377</span>              :             if ((_handle == -1) &amp;&amp; (errno == ENOENT)) {</span>
<span id="L378"><span class="lineNum">     378</span>              :                 return (Create());</span>
<span id="L379"><span class="lineNum">     379</span>              :             }</span>
<span id="L380"><span class="lineNum">     380</span>              : #endif</span>
<span id="L381"><span class="lineNum">     381</span>              : #ifdef __WINDOWS__</span>
<span id="L382"><span class="lineNum">     382</span>              :             _handle = ::CreateFile(_name.c_str(), GENERIC_READ | GENERIC_WRITE, 0, nullptr, OPEN_ALWAYS, FILE_ATTRIBUTE_NORMAL, nullptr);</span>
<span id="L383"><span class="lineNum">     383</span>              :             if (_handle != INVALID_HANDLE_VALUE) {</span>
<span id="L384"><span class="lineNum">     384</span>              :                 ::SetFilePointer(_handle, 0, nullptr, FILE_END);</span>
<span id="L385"><span class="lineNum">     385</span>              :             }</span>
<span id="L386"><span class="lineNum">     386</span>              : #endif</span>
<span id="L387"><span class="lineNum">     387</span>              :             return (IsOpen());</span>
<span id="L388"><span class="lineNum">     388</span>              :         }</span>
<span id="L389"><span class="lineNum">     389</span>              :         bool Unlink()</span>
<span id="L390"><span class="lineNum">     390</span>              :         {</span>
<span id="L391"><span class="lineNum">     391</span>              :             bool result = true;</span>
<span id="L392"><span class="lineNum">     392</span>              : </span>
<span id="L393"><span class="lineNum">     393</span>              :             if (Exists() == true) {</span>
<span id="L394"><span class="lineNum">     394</span>              :                 Close();</span>
<span id="L395"><span class="lineNum">     395</span>              : #ifdef __POSIX__</span>
<span id="L396"><span class="lineNum">     396</span>              :                 result = (unlink(_name.c_str()) == 0);</span>
<span id="L397"><span class="lineNum">     397</span>              : #endif</span>
<span id="L398"><span class="lineNum">     398</span>              : #ifdef __WINDOWS__</span>
<span id="L399"><span class="lineNum">     399</span>              :                 result = (::DeleteFile(_name.c_str()) != FALSE);</span>
<span id="L400"><span class="lineNum">     400</span>              : #endif</span>
<span id="L401"><span class="lineNum">     401</span>              :             }</span>
<span id="L402"><span class="lineNum">     402</span>              :             return (result);</span>
<span id="L403"><span class="lineNum">     403</span>              :         }</span>
<span id="L404"><span class="lineNum">     404</span>              :         bool Destroy()</span>
<span id="L405"><span class="lineNum">     405</span>              :         {</span>
<span id="L406"><span class="lineNum">     406</span>              :             bool result = true;</span>
<span id="L407"><span class="lineNum">     407</span>              : </span>
<span id="L408"><span class="lineNum">     408</span>              :             if (Exists() == true) {</span>
<span id="L409"><span class="lineNum">     409</span>              :                 Close();</span>
<span id="L410"><span class="lineNum">     410</span>              : </span>
<span id="L411"><span class="lineNum">     411</span>              : #ifdef __POSIX__</span>
<span id="L412"><span class="lineNum">     412</span>              :                 result = (remove(_name.c_str()) == 0);</span>
<span id="L413"><span class="lineNum">     413</span>              : #endif</span>
<span id="L414"><span class="lineNum">     414</span>              : #ifdef __WINDOWS__</span>
<span id="L415"><span class="lineNum">     415</span>              :                 result = (::DeleteFile(_name.c_str()) != FALSE);</span>
<span id="L416"><span class="lineNum">     416</span>              : #endif</span>
<span id="L417"><span class="lineNum">     417</span>              :             }</span>
<span id="L418"><span class="lineNum">     418</span>              :             return (result);</span>
<span id="L419"><span class="lineNum">     419</span>              :         }</span>
<span id="L420"><span class="lineNum">     420</span>              :         bool Move(const string&amp; newLocation)</span>
<span id="L421"><span class="lineNum">     421</span>              :         {</span>
<span id="L422"><span class="lineNum">     422</span>              :             bool result = false;</span>
<span id="L423"><span class="lineNum">     423</span>              : </span>
<span id="L424"><span class="lineNum">     424</span>              :             if (Exists() == true) {</span>
<span id="L425"><span class="lineNum">     425</span>              :                 Close();</span>
<span id="L426"><span class="lineNum">     426</span>              : </span>
<span id="L427"><span class="lineNum">     427</span>              : #ifdef __POSIX__</span>
<span id="L428"><span class="lineNum">     428</span>              :                 result = (rename(_name.c_str(), newLocation.c_str()) == 0);</span>
<span id="L429"><span class="lineNum">     429</span>              : #endif</span>
<span id="L430"><span class="lineNum">     430</span>              : #ifdef __WINDOWS__</span>
<span id="L431"><span class="lineNum">     431</span>              :                 result = (::MoveFile(_name.c_str(), newLocation.c_str()) != FALSE);</span>
<span id="L432"><span class="lineNum">     432</span>              : #endif</span>
<span id="L433"><span class="lineNum">     433</span>              : </span>
<span id="L434"><span class="lineNum">     434</span>              :                 if (result == true) {</span>
<span id="L435"><span class="lineNum">     435</span>              :                     _name = newLocation;</span>
<span id="L436"><span class="lineNum">     436</span>              :                     LoadFileInfo();</span>
<span id="L437"><span class="lineNum">     437</span>              :                 }</span>
<span id="L438"><span class="lineNum">     438</span>              :             }</span>
<span id="L439"><span class="lineNum">     439</span>              : </span>
<span id="L440"><span class="lineNum">     440</span>              :             return (result);</span>
<span id="L441"><span class="lineNum">     441</span>              :         }</span>
<span id="L442"><span class="lineNum">     442</span>              :         void Close() const</span>
<span id="L443"><span class="lineNum">     443</span>              :         {</span>
<span id="L444"><span class="lineNum">     444</span>              :             if (IsOpen()) {</span>
<span id="L445"><span class="lineNum">     445</span>              : #ifdef __POSIX__</span>
<span id="L446"><span class="lineNum">     446</span>              :                 close(_handle);</span>
<span id="L447"><span class="lineNum">     447</span>              :                 _handle = -1;</span>
<span id="L448"><span class="lineNum">     448</span>              : #endif</span>
<span id="L449"><span class="lineNum">     449</span>              : #ifdef __WINDOWS__</span>
<span id="L450"><span class="lineNum">     450</span>              :                 ::CloseHandle(_handle);</span>
<span id="L451"><span class="lineNum">     451</span>              :                 _handle = INVALID_HANDLE_VALUE;</span>
<span id="L452"><span class="lineNum">     452</span>              : #endif</span>
<span id="L453"><span class="lineNum">     453</span>              :             }</span>
<span id="L454"><span class="lineNum">     454</span>              :         }</span>
<span id="L455"><span class="lineNum">     455</span>              :         uint32_t Write(const uint8_t buffer[], uint32_t size)</span>
<span id="L456"><span class="lineNum">     456</span>              :         {</span>
<span id="L457"><span class="lineNum">     457</span>              :             // Only call these methods if the file is open.</span>
<span id="L458"><span class="lineNum">     458</span>              :             ASSERT(IsOpen());</span>
<span id="L459"><span class="lineNum">     459</span>              : </span>
<span id="L460"><span class="lineNum">     460</span>              : #ifdef __POSIX__</span>
<span id="L461"><span class="lineNum">     461</span>              :             int value = write(_handle, buffer, size);</span>
<span id="L462"><span class="lineNum">     462</span>              : </span>
<span id="L463"><span class="lineNum">     463</span>              :             if (value == -1) {</span>
<span id="L464"><span class="lineNum">     464</span>              :                 return (0);</span>
<span id="L465"><span class="lineNum">     465</span>              :             } else {</span>
<span id="L466"><span class="lineNum">     466</span>              :                 return (static_cast&lt;uint32_t&gt;(value));</span>
<span id="L467"><span class="lineNum">     467</span>              :             }</span>
<span id="L468"><span class="lineNum">     468</span>              : #endif</span>
<span id="L469"><span class="lineNum">     469</span>              : </span>
<span id="L470"><span class="lineNum">     470</span>              : #ifdef __WINDOWS__</span>
<span id="L471"><span class="lineNum">     471</span>              :             DWORD writtenBytes;</span>
<span id="L472"><span class="lineNum">     472</span>              : </span>
<span id="L473"><span class="lineNum">     473</span>              :             ::WriteFile(_handle, buffer, size, &amp;writtenBytes, nullptr);</span>
<span id="L474"><span class="lineNum">     474</span>              :             return static_cast&lt;uint32_t&gt;(writtenBytes);</span>
<span id="L475"><span class="lineNum">     475</span>              : #endif</span>
<span id="L476"><span class="lineNum">     476</span>              :         }</span>
<span id="L477"><span class="lineNum">     477</span>              :         uint32_t Read(uint8_t buffer[], uint32_t size) const</span>
<span id="L478"><span class="lineNum">     478</span>              :         {</span>
<span id="L479"><span class="lineNum">     479</span>              :             // Only call these methods if the file is open.</span>
<span id="L480"><span class="lineNum">     480</span>              :             ASSERT(IsOpen());</span>
<span id="L481"><span class="lineNum">     481</span>              : </span>
<span id="L482"><span class="lineNum">     482</span>              : #ifdef __POSIX__</span>
<span id="L483"><span class="lineNum">     483</span>              :             int value = read(_handle, buffer, size);</span>
<span id="L484"><span class="lineNum">     484</span>              : </span>
<span id="L485"><span class="lineNum">     485</span>              :             if (value == -1) {</span>
<span id="L486"><span class="lineNum">     486</span>              :                 return (0);</span>
<span id="L487"><span class="lineNum">     487</span>              :             } else {</span>
<span id="L488"><span class="lineNum">     488</span>              :                 return (static_cast&lt;uint32_t&gt;(value));</span>
<span id="L489"><span class="lineNum">     489</span>              :             }</span>
<span id="L490"><span class="lineNum">     490</span>              : #endif</span>
<span id="L491"><span class="lineNum">     491</span>              : #ifdef __WINDOWS__</span>
<span id="L492"><span class="lineNum">     492</span>              :             DWORD readBytes = 0;</span>
<span id="L493"><span class="lineNum">     493</span>              :             ::ReadFile(_handle, buffer, size, &amp;readBytes, nullptr);</span>
<span id="L494"><span class="lineNum">     494</span>              :             return static_cast&lt;uint32_t&gt;(readBytes);</span>
<span id="L495"><span class="lineNum">     495</span>              : #endif</span>
<span id="L496"><span class="lineNum">     496</span>              :         }</span>
<span id="L497"><span class="lineNum">     497</span>              : </span>
<span id="L498"><span class="lineNum">     498</span>              :         bool Position(const bool relative, int64_t offset)</span>
<span id="L499"><span class="lineNum">     499</span>              :         {</span>
<span id="L500"><span class="lineNum">     500</span>              :             // Only call these methods if the file is open.</span>
<span id="L501"><span class="lineNum">     501</span>              :             ASSERT(IsOpen());</span>
<span id="L502"><span class="lineNum">     502</span>              : </span>
<span id="L503"><span class="lineNum">     503</span>              : #ifdef __POSIX__</span>
<span id="L504"><span class="lineNum">     504</span>              :             return (LSEEK(_handle, offset, (relative ? SEEK_CUR : SEEK_SET)) != -1);</span>
<span id="L505"><span class="lineNum">     505</span>              : #endif</span>
<span id="L506"><span class="lineNum">     506</span>              : #ifdef __WINDOWS__</span>
<span id="L507"><span class="lineNum">     507</span>              :             LARGE_INTEGER value; value.QuadPart = offset;</span>
<span id="L508"><span class="lineNum">     508</span>              :             return (::SetFilePointerEx(_handle, value, nullptr, (relative ? FILE_CURRENT : FILE_BEGIN)));</span>
<span id="L509"><span class="lineNum">     509</span>              : #endif</span>
<span id="L510"><span class="lineNum">     510</span>              :         }</span>
<span id="L511"><span class="lineNum">     511</span>              :         int64_t Position() const</span>
<span id="L512"><span class="lineNum">     512</span>              :         {</span>
<span id="L513"><span class="lineNum">     513</span>              :             int64_t result = 0;</span>
<span id="L514"><span class="lineNum">     514</span>              : </span>
<span id="L515"><span class="lineNum">     515</span>              :             // If the file is not open, we are at the beginning :-)</span>
<span id="L516"><span class="lineNum">     516</span>              :             if (IsOpen()) {</span>
<span id="L517"><span class="lineNum">     517</span>              : #ifdef __POSIX__</span>
<span id="L518"><span class="lineNum">     518</span>              :                 result = LSEEK(_handle, 0, SEEK_CUR);</span>
<span id="L519"><span class="lineNum">     519</span>              :                 ASSERT(result &gt;= 0);</span>
<span id="L520"><span class="lineNum">     520</span>              : </span>
<span id="L521"><span class="lineNum">     521</span>              :                 if (result == -1) {</span>
<span id="L522"><span class="lineNum">     522</span>              :                     result = 0;</span>
<span id="L523"><span class="lineNum">     523</span>              :                 }</span>
<span id="L524"><span class="lineNum">     524</span>              : </span>
<span id="L525"><span class="lineNum">     525</span>              : #endif</span>
<span id="L526"><span class="lineNum">     526</span>              : #ifdef __WINDOWS__</span>
<span id="L527"><span class="lineNum">     527</span>              :                 LARGE_INTEGER newPos;</span>
<span id="L528"><span class="lineNum">     528</span>              :                 LARGE_INTEGER startPos; startPos.QuadPart = 0;</span>
<span id="L529"><span class="lineNum">     529</span>              : </span>
<span id="L530"><span class="lineNum">     530</span>              :                 if (::SetFilePointerEx(_handle, startPos, &amp;newPos, FILE_CURRENT)) {</span>
<span id="L531"><span class="lineNum">     531</span>              :                     ASSERT(newPos.QuadPart &gt;= 0);</span>
<span id="L532"><span class="lineNum">     532</span>              : </span>
<span id="L533"><span class="lineNum">     533</span>              :                     result = newPos.QuadPart;</span>
<span id="L534"><span class="lineNum">     534</span>              :                 }</span>
<span id="L535"><span class="lineNum">     535</span>              : #endif</span>
<span id="L536"><span class="lineNum">     536</span>              :             }</span>
<span id="L537"><span class="lineNum">     537</span>              : </span>
<span id="L538"><span class="lineNum">     538</span>              :             return (result);</span>
<span id="L539"><span class="lineNum">     539</span>              :         }</span>
<span id="L540"><span class="lineNum">     540</span>              : </span>
<span id="L541"><span class="lineNum">     541</span>              :         Handle DuplicateHandle() const</span>
<span id="L542"><span class="lineNum">     542</span>              :         {</span>
<span id="L543"><span class="lineNum">     543</span>              :             Handle result = INVALID_HANDLE_VALUE;</span>
<span id="L544"><span class="lineNum">     544</span>              : </span>
<span id="L545"><span class="lineNum">     545</span>              :             if (_handle != INVALID_HANDLE_VALUE) {</span>
<span id="L546"><span class="lineNum">     546</span>              : #ifdef __POSIX__</span>
<span id="L547"><span class="lineNum">     547</span>              :                 result = ::dup(_handle);</span>
<span id="L548"><span class="lineNum">     548</span>              : #else</span>
<span id="L549"><span class="lineNum">     549</span>              :                 ::DuplicateHandle(GetCurrentProcess(), _handle, GetCurrentProcess(), &amp;result, 0, FALSE, DUPLICATE_SAME_ACCESS);</span>
<span id="L550"><span class="lineNum">     550</span>              : #endif</span>
<span id="L551"><span class="lineNum">     551</span>              :             }</span>
<span id="L552"><span class="lineNum">     552</span>              : </span>
<span id="L553"><span class="lineNum">     553</span>              :             return (result);</span>
<span id="L554"><span class="lineNum">     554</span>              :         }</span>
<span id="L555"><span class="lineNum">     555</span>              : </span>
<span id="L556"><span class="lineNum">     556</span>              :         operator Handle()</span>
<span id="L557"><span class="lineNum">     557</span>              :         {</span>
<span id="L558"><span class="lineNum">     558</span>              :             return (_handle);</span>
<span id="L559"><span class="lineNum">     559</span>              :         }</span>
<span id="L560"><span class="lineNum">     560</span>              : </span>
<span id="L561"><span class="lineNum">     561</span>              :         operator FILE*()</span>
<span id="L562"><span class="lineNum">     562</span>              :         {</span>
<span id="L563"><span class="lineNum">     563</span>              :             if (_handle != INVALID_HANDLE_VALUE) {</span>
<span id="L564"><span class="lineNum">     564</span>              : #ifdef __POSIX__</span>
<span id="L565"><span class="lineNum">     565</span>              :                 return (fdopen(DuplicateHandle(), (IsReadOnly() ? &quot;r&quot; : &quot;r+&quot;)));</span>
<span id="L566"><span class="lineNum">     566</span>              : #endif</span>
<span id="L567"><span class="lineNum">     567</span>              : #ifdef __WINDOWS__</span>
<span id="L568"><span class="lineNum">     568</span>              :                 Handle fd = DuplicateHandle();</span>
<span id="L569"><span class="lineNum">     569</span>              : PUSH_WARNING(DISABLE_WARNING_POINTER_TRUNCATION, DISABLE_WARNING_CONVERSION_TRUNCATION)</span>
<span id="L570"><span class="lineNum">     570</span>              :                 return ((fd != 0) ? ::_fdopen(reinterpret_cast&lt;int&gt;(fd), (IsReadOnly() ? &quot;r&quot; : &quot;r+&quot;)) : nullptr);</span>
<span id="L571"><span class="lineNum">     571</span>              : POP_WARNING()</span>
<span id="L572"><span class="lineNum">     572</span>              : #endif</span>
<span id="L573"><span class="lineNum">     573</span>              :             } else {</span>
<span id="L574"><span class="lineNum">     574</span>              :                 return nullptr;</span>
<span id="L575"><span class="lineNum">     575</span>              :             }</span>
<span id="L576"><span class="lineNum">     576</span>              :         }</span>
<span id="L577"><span class="lineNum">     577</span>              : </span>
<span id="L578"><span class="lineNum">     578</span>              :         void LoadFileInfo();</span>
<span id="L579"><span class="lineNum">     579</span>              : </span>
<span id="L580"><span class="lineNum">     580</span>              :         uint32_t User(const string&amp; userName) const;</span>
<span id="L581"><span class="lineNum">     581</span>              :         uint32_t Group(const string&amp; groupName) const;</span>
<span id="L582"><span class="lineNum">     582</span>              :         uint32_t Permission(uint16_t flags) const;</span>
<span id="L583"><span class="lineNum">     583</span>              : </span>
<span id="L584"><span class="lineNum">     584</span>              :     private:</span>
<span id="L585"><span class="lineNum">     585</span>              :         inline static uint32_t ExtensionOffset(const string&amp; name)</span>
<span id="L586"><span class="lineNum">     586</span>              :         {</span>
<span id="L587"><span class="lineNum">     587</span>              :             int offset;</span>
<span id="L588"><span class="lineNum">     588</span>              :             return (((offset = static_cast&lt;int&gt;(name.find_last_of('.'))) == -1) ? 0 : offset + 1);</span>
<span id="L589"><span class="lineNum">     589</span>              :         }</span>
<span id="L590"><span class="lineNum">     590</span>              :         inline static uint32_t FileNameOffset(const string&amp; name)</span>
<span id="L591"><span class="lineNum">     591</span>              :         {</span>
<span id="L592"><span class="lineNum">     592</span>              :             int offset;</span>
<span id="L593"><span class="lineNum">     593</span>              :             if ((offset = static_cast&lt;int&gt;(name.find_last_of('/'))) != -1) {</span>
<span id="L594"><span class="lineNum">     594</span>              :                 // under linux/posix this is enough..</span>
<span id="L595"><span class="lineNum">     595</span>              :                 offset++;</span>
<span id="L596"><span class="lineNum">     596</span>              :             } else {</span>
<span id="L597"><span class="lineNum">     597</span>              :                 offset = 0;</span>
<span id="L598"><span class="lineNum">     598</span>              :             }</span>
<span id="L599"><span class="lineNum">     599</span>              : #ifdef __WINDOWS__</span>
<span id="L600"><span class="lineNum">     600</span>              :             int intermediate;</span>
<span id="L601"><span class="lineNum">     601</span>              :             if ((intermediate = static_cast&lt;int&gt;(name.find_last_of('\\'))) != -1) {</span>
<span id="L602"><span class="lineNum">     602</span>              :                 if (intermediate &gt; offset) {</span>
<span id="L603"><span class="lineNum">     603</span>              :                     offset = intermediate + 1;</span>
<span id="L604"><span class="lineNum">     604</span>              :                 }</span>
<span id="L605"><span class="lineNum">     605</span>              :             }</span>
<span id="L606"><span class="lineNum">     606</span>              :             if ((offset == 0) &amp;&amp; ((intermediate = static_cast&lt;int&gt;(name.find_last_of(':'))) != -1)) {</span>
<span id="L607"><span class="lineNum">     607</span>              :                 offset = intermediate + 1;</span>
<span id="L608"><span class="lineNum">     608</span>              :             }</span>
<span id="L609"><span class="lineNum">     609</span>              : #endif</span>
<span id="L610"><span class="lineNum">     610</span>              : </span>
<span id="L611"><span class="lineNum">     611</span>              :             return (static_cast&lt;uint32_t&gt;(offset));</span>
<span id="L612"><span class="lineNum">     612</span>              :         }</span>
<span id="L613"><span class="lineNum">     613</span>              : </span>
<span id="L614"><span class="lineNum">     614</span>              :     private:</span>
<span id="L615"><span class="lineNum">     615</span>              :         string _name;</span>
<span id="L616"><span class="lineNum">     616</span>              :         uint64_t _size;</span>
<span id="L617"><span class="lineNum">     617</span>              :         uint32_t _attributes;</span>
<span id="L618"><span class="lineNum">     618</span>              :         Core::Time _creation;</span>
<span id="L619"><span class="lineNum">     619</span>              :         Core::Time _modification;</span>
<span id="L620"><span class="lineNum">     620</span>              :         Core::Time _access;</span>
<span id="L621"><span class="lineNum">     621</span>              :         mutable Handle _handle;</span>
<span id="L622"><span class="lineNum">     622</span>              :     };</span>
<span id="L623"><span class="lineNum">     623</span>              : </span>
<span id="L624"><span class="lineNum">     624</span>              :     class EXTERNAL Directory {</span>
<span id="L625"><span class="lineNum">     625</span>              :     public:</span>
<span id="L626"><span class="lineNum">     626</span>              :         Directory();</span>
<span id="L627"><span class="lineNum">     627</span>              :         explicit Directory(const TCHAR location[]);</span>
<span id="L628"><span class="lineNum">     628</span>              :         Directory(const TCHAR location[], const TCHAR filter[]);</span>
<span id="L629"><span class="lineNum">     629</span>              :         Directory(const Directory&amp; copy);</span>
<span id="L630"><span class="lineNum">     630</span>              :         ~Directory();</span>
<span id="L631"><span class="lineNum">     631</span>              : </span>
<span id="L632"><span class="lineNum">     632</span>              :     public:</span>
<span id="L633"><span class="lineNum">     633</span>              :         static string Normalize(const string&amp; location)</span>
<span id="L634"><span class="lineNum">     634</span>              :         {</span>
<span id="L635"><span class="lineNum">     635</span>              :             string result;</span>
<span id="L636"><span class="lineNum">     636</span>              : </span>
<span id="L637"><span class="lineNum">     637</span>              :             // First see if we are not empy.</span>
<span id="L638"><span class="lineNum">     638</span>              :             if (location.empty() == false) {</span>
<span id="L639"><span class="lineNum">     639</span>              : </span>
<span id="L640"><span class="lineNum">     640</span>              :                 bool valid;</span>
<span id="L641"><span class="lineNum">     641</span>              :                 result = File::Normalize(location, valid);</span>
<span id="L642"><span class="lineNum">     642</span>              : </span>
<span id="L643"><span class="lineNum">     643</span>              :                 if ((valid == true) &amp;&amp; ((result.empty() == true) || (result[result.length() - 1] != '/'))) {</span>
<span id="L644"><span class="lineNum">     644</span>              :                     result += '/';</span>
<span id="L645"><span class="lineNum">     645</span>              :                 }</span>
<span id="L646"><span class="lineNum">     646</span>              :             }</span>
<span id="L647"><span class="lineNum">     647</span>              :             return (result);</span>
<span id="L648"><span class="lineNum">     648</span>              :         }</span>
<span id="L649"><span class="lineNum">     649</span>              : </span>
<span id="L650"><span class="lineNum">     650</span>              :         bool Create();</span>
<span id="L651"><span class="lineNum">     651</span>              :         bool CreatePath();</span>
<span id="L652"><span class="lineNum">     652</span>              : </span>
<span id="L653"><span class="lineNum">     653</span>              :         Directory&amp; operator=(const TCHAR location[])</span>
<span id="L654"><span class="lineNum">     654</span>              :         {</span>
<span id="L655"><span class="lineNum">     655</span>              :             _name = location;</span>
<span id="L656"><span class="lineNum">     656</span>              :             return (*this);</span>
<span id="L657"><span class="lineNum">     657</span>              :         }</span>
<span id="L658"><span class="lineNum">     658</span>              : </span>
<span id="L659"><span class="lineNum">     659</span>              :         bool Exists() const; </span>
<span id="L660"><span class="lineNum">     660</span>              : </span>
<span id="L661"><span class="lineNum">     661</span>              : #ifdef __LINUX__</span>
<span id="L662"><span class="lineNum">     662</span>              :         bool IsValid() const</span>
<span id="L663"><span class="lineNum">     663</span>              :         {</span>
<span id="L664"><span class="lineNum">     664</span>              :             return ((_dirFD != nullptr) &amp;&amp; (_entry != nullptr));</span>
<span id="L665"><span class="lineNum">     665</span>              :         }</span>
<span id="L666"><span class="lineNum">     666</span>              :         void Reset()</span>
<span id="L667"><span class="lineNum">     667</span>              :         {</span>
<span id="L668"><span class="lineNum">     668</span>              :             if (_dirFD != nullptr) {</span>
<span id="L669"><span class="lineNum">     669</span>              :                 closedir(_dirFD);</span>
<span id="L670"><span class="lineNum">     670</span>              :             }</span>
<span id="L671"><span class="lineNum">     671</span>              :             _dirFD = nullptr;</span>
<span id="L672"><span class="lineNum">     672</span>              :             _entry = nullptr;</span>
<span id="L673"><span class="lineNum">     673</span>              :         }</span>
<span id="L674"><span class="lineNum">     674</span>              :         bool Next()</span>
<span id="L675"><span class="lineNum">     675</span>              :         {</span>
<span id="L676"><span class="lineNum">     676</span>              :             bool valid = false;</span>
<span id="L677"><span class="lineNum">     677</span>              : </span>
<span id="L678"><span class="lineNum">     678</span>              :             if ((_dirFD == nullptr) &amp;&amp; (_entry == nullptr)) {</span>
<span id="L679"><span class="lineNum">     679</span>              :                 _dirFD = opendir(_name.c_str());</span>
<span id="L680"><span class="lineNum">     680</span>              :             }</span>
<span id="L681"><span class="lineNum">     681</span>              : </span>
<span id="L682"><span class="lineNum">     682</span>              :             while ((_dirFD != nullptr) &amp;&amp; (valid == false)) {</span>
<span id="L683"><span class="lineNum">     683</span>              :                 _entry = readdir(_dirFD);</span>
<span id="L684"><span class="lineNum">     684</span>              : </span>
<span id="L685"><span class="lineNum">     685</span>              :                 if (_entry != nullptr) {</span>
<span id="L686"><span class="lineNum">     686</span>              :                     valid = (fnmatch(_filter.c_str(), _entry-&gt;d_name, FNM_CASEFOLD) == 0);</span>
<span id="L687"><span class="lineNum">     687</span>              :                 } else {</span>
<span id="L688"><span class="lineNum">     688</span>              :                     // We are at the end..</span>
<span id="L689"><span class="lineNum">     689</span>              :                     if (_dirFD != nullptr) {</span>
<span id="L690"><span class="lineNum">     690</span>              :                         closedir(_dirFD);</span>
<span id="L691"><span class="lineNum">     691</span>              :                         _dirFD = nullptr;</span>
<span id="L692"><span class="lineNum">     692</span>              :                     }</span>
<span id="L693"><span class="lineNum">     693</span>              :                     _entry = reinterpret_cast&lt;dirent*&gt;(~0);</span>
<span id="L694"><span class="lineNum">     694</span>              :                 }</span>
<span id="L695"><span class="lineNum">     695</span>              :             }</span>
<span id="L696"><span class="lineNum">     696</span>              : </span>
<span id="L697"><span class="lineNum">     697</span>              :             return (valid);</span>
<span id="L698"><span class="lineNum">     698</span>              :         }</span>
<span id="L699"><span class="lineNum">     699</span>              :         inline string Current() const</span>
<span id="L700"><span class="lineNum">     700</span>              :         {</span>
<span id="L701"><span class="lineNum">     701</span>              :             return (_name + _entry-&gt;d_name);</span>
<span id="L702"><span class="lineNum">     702</span>              :         }</span>
<span id="L703"><span class="lineNum">     703</span>              :         inline string Name() const</span>
<span id="L704"><span class="lineNum">     704</span>              :         {</span>
<span id="L705"><span class="lineNum">     705</span>              :             return (_entry-&gt;d_name);</span>
<span id="L706"><span class="lineNum">     706</span>              :         }</span>
<span id="L707"><span class="lineNum">     707</span>              :         inline bool IsDirectory() const</span>
<span id="L708"><span class="lineNum">     708</span>              :         {</span>
<span id="L709"><span class="lineNum">     709</span>              :             return (_entry != nullptr ? ((_entry-&gt;d_type &amp; DT_DIR) != 0) : false);</span>
<span id="L710"><span class="lineNum">     710</span>              :         }</span>
<span id="L711"><span class="lineNum">     711</span>              : #endif</span>
<span id="L712"><span class="lineNum">     712</span>              : </span>
<span id="L713"><span class="lineNum">     713</span>              : #ifdef __WINDOWS__</span>
<span id="L714"><span class="lineNum">     714</span>              :         bool IsValid() const</span>
<span id="L715"><span class="lineNum">     715</span>              :         {</span>
<span id="L716"><span class="lineNum">     716</span>              :             return ((_dirFD != INVALID_HANDLE_VALUE) &amp;&amp; (noMoreFiles == false));</span>
<span id="L717"><span class="lineNum">     717</span>              :         }</span>
<span id="L718"><span class="lineNum">     718</span>              :         void Reset()</span>
<span id="L719"><span class="lineNum">     719</span>              :         {</span>
<span id="L720"><span class="lineNum">     720</span>              :             _dirFD = INVALID_HANDLE_VALUE;</span>
<span id="L721"><span class="lineNum">     721</span>              : </span>
<span id="L722"><span class="lineNum">     722</span>              :             if (_dirFD != INVALID_HANDLE_VALUE) {</span>
<span id="L723"><span class="lineNum">     723</span>              :                 ::FindClose(_dirFD);</span>
<span id="L724"><span class="lineNum">     724</span>              :                 _dirFD = INVALID_HANDLE_VALUE;</span>
<span id="L725"><span class="lineNum">     725</span>              :             }</span>
<span id="L726"><span class="lineNum">     726</span>              :         }</span>
<span id="L727"><span class="lineNum">     727</span>              :         bool Next()</span>
<span id="L728"><span class="lineNum">     728</span>              :         {</span>
<span id="L729"><span class="lineNum">     729</span>              :             if (_dirFD == INVALID_HANDLE_VALUE) {</span>
<span id="L730"><span class="lineNum">     730</span>              :                 _dirFD = ::FindFirstFile((_name + _filter).c_str(), &amp;_data);</span>
<span id="L731"><span class="lineNum">     731</span>              :             } else if (::FindNextFile(_dirFD, &amp;_data) == FALSE) {</span>
<span id="L732"><span class="lineNum">     732</span>              :                 // We are at the end</span>
<span id="L733"><span class="lineNum">     733</span>              :                 noMoreFiles = true;</span>
<span id="L734"><span class="lineNum">     734</span>              :             }</span>
<span id="L735"><span class="lineNum">     735</span>              : </span>
<span id="L736"><span class="lineNum">     736</span>              :             return (IsValid());</span>
<span id="L737"><span class="lineNum">     737</span>              :         }</span>
<span id="L738"><span class="lineNum">     738</span>              :         inline string Current() const</span>
<span id="L739"><span class="lineNum">     739</span>              :         {</span>
<span id="L740"><span class="lineNum">     740</span>              :             return (_name + _data.cFileName);</span>
<span id="L741"><span class="lineNum">     741</span>              :         }</span>
<span id="L742"><span class="lineNum">     742</span>              :         inline string Name() const</span>
<span id="L743"><span class="lineNum">     743</span>              :         {</span>
<span id="L744"><span class="lineNum">     744</span>              :             return (_data.cFileName);</span>
<span id="L745"><span class="lineNum">     745</span>              :         }</span>
<span id="L746"><span class="lineNum">     746</span>              :         inline bool IsDirectory() const</span>
<span id="L747"><span class="lineNum">     747</span>              :         {</span>
<span id="L748"><span class="lineNum">     748</span>              :             return ((_data.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY) == FILE_ATTRIBUTE_DIRECTORY);</span>
<span id="L749"><span class="lineNum">     749</span>              :         }</span>
<span id="L750"><span class="lineNum">     750</span>              : #endif</span>
<span id="L751"><span class="lineNum">     751</span>              : </span>
<span id="L752"><span class="lineNum">     752</span>              :         Directory&amp; operator=(const Directory&amp; RHS)</span>
<span id="L753"><span class="lineNum">     753</span>              :         {</span>
<span id="L754"><span class="lineNum">     754</span>              :             _name = RHS._name;</span>
<span id="L755"><span class="lineNum">     755</span>              :             return (*this);</span>
<span id="L756"><span class="lineNum">     756</span>              :         }</span>
<span id="L757"><span class="lineNum">     757</span>              : </span>
<span id="L758"><span class="lineNum">     758</span>              :         bool Destroy () {</span>
<span id="L759"><span class="lineNum">     759</span>              : </span>
<span id="L760"><span class="lineNum">     760</span>              :             // Allow only if the path does not contain &quot;..&quot; entries</span>
<span id="L761"><span class="lineNum">     761</span>              :             Reset();</span>
<span id="L762"><span class="lineNum">     762</span>              : </span>
<span id="L763"><span class="lineNum">     763</span>              :             while (Next() == true) {</span>
<span id="L764"><span class="lineNum">     764</span>              :                 Core::File file(Current());</span>
<span id="L765"><span class="lineNum">     765</span>              : </span>
<span id="L766"><span class="lineNum">     766</span>              :                 if (file.IsDirectory() == true) {</span>
<span id="L767"><span class="lineNum">     767</span>              :                     string name(file.FileName());</span>
<span id="L768"><span class="lineNum">     768</span>              : </span>
<span id="L769"><span class="lineNum">     769</span>              :                     // We can not delete the &quot;.&quot; or  &quot;..&quot; entries....</span>
<span id="L770"><span class="lineNum">     770</span>              :                     if ( (name.length() &gt; 2) || </span>
<span id="L771"><span class="lineNum">     771</span>              :                             ((name.length() == 1) &amp;&amp; (name[0] != '.')) ||</span>
<span id="L772"><span class="lineNum">     772</span>              :                             ((name.length() == 2) &amp;&amp; !((name[0] == '.') &amp;&amp; (name[1] == '.'))) ) {</span>
<span id="L773"><span class="lineNum">     773</span>              :                         Directory deleteIt(Current().c_str());</span>
<span id="L774"><span class="lineNum">     774</span>              :                         deleteIt.Destroy();</span>
<span id="L775"><span class="lineNum">     775</span>              :                         file.Destroy();</span>
<span id="L776"><span class="lineNum">     776</span>              :                     }</span>
<span id="L777"><span class="lineNum">     777</span>              :                 } else {</span>
<span id="L778"><span class="lineNum">     778</span>              :                     file.Destroy();</span>
<span id="L779"><span class="lineNum">     779</span>              :                 }</span>
<span id="L780"><span class="lineNum">     780</span>              :             }</span>
<span id="L781"><span class="lineNum">     781</span>              : </span>
<span id="L782"><span class="lineNum">     782</span>              :             if (_name.back() != '/') {</span>
<span id="L783"><span class="lineNum">     783</span>              :                 Core::File(_name).Destroy();</span>
<span id="L784"><span class="lineNum">     784</span>              :             }</span>
<span id="L785"><span class="lineNum">     785</span>              : </span>
<span id="L786"><span class="lineNum">     786</span>              :             return (true);</span>
<span id="L787"><span class="lineNum">     787</span>              :         }</span>
<span id="L788"><span class="lineNum">     788</span>              : </span>
<span id="L789"><span class="lineNum">     789</span>              :         uint32_t User(const string&amp; userName) const;</span>
<span id="L790"><span class="lineNum">     790</span>              :         uint32_t Group(const string&amp; groupName) const;</span>
<span id="L791"><span class="lineNum">     791</span>              :         uint32_t Permission(uint16_t flags) const;</span>
<span id="L792"><span class="lineNum">     792</span>              : </span>
<span id="L793"><span class="lineNum">     793</span>              :     private:</span>
<span id="L794"><span class="lineNum">     794</span>              :         string _name;</span>
<span id="L795"><span class="lineNum">     795</span>              :         string _filter;</span>
<span id="L796"><span class="lineNum">     796</span>              : </span>
<span id="L797"><span class="lineNum">     797</span>              : #ifdef __LINUX__</span>
<span id="L798"><span class="lineNum">     798</span>              :         DIR* _dirFD;</span>
<span id="L799"><span class="lineNum">     799</span>              :         struct dirent* _entry;</span>
<span id="L800"><span class="lineNum">     800</span>              : #endif</span>
<span id="L801"><span class="lineNum">     801</span>              : </span>
<span id="L802"><span class="lineNum">     802</span>              : #ifdef __WINDOWS__</span>
<span id="L803"><span class="lineNum">     803</span>              :         HANDLE _dirFD;</span>
<span id="L804"><span class="lineNum">     804</span>              :         WIN32_FIND_DATA _data;</span>
<span id="L805"><span class="lineNum">     805</span>              :         bool noMoreFiles;</span>
<span id="L806"><span class="lineNum">     806</span>              : #endif</span>
<span id="L807"><span class="lineNum">     807</span>              :     };</span>
<span id="L808"><span class="lineNum">     808</span>              : </span>
<span id="L809"><span class="lineNum">     809</span>              :     class EXTERNAL Partition {</span>
<span id="L810"><span class="lineNum">     810</span>              :     private:</span>
<span id="L811"><span class="lineNum">     811</span>              :         static constexpr const TCHAR LineSeparator = _T('\n');</span>
<span id="L812"><span class="lineNum">     812</span>              :         static constexpr const TCHAR WordSeparator = _T(' ');</span>
<span id="L813"><span class="lineNum">     813</span>              :         static constexpr const TCHAR PathSeparator = _T('/');</span>
<span id="L814"><span class="lineNum">     814</span>              : </span>
<span id="L815"><span class="lineNum">     815</span>              : #ifdef __POSIX__</span>
<span id="L816"><span class="lineNum">     816</span>              :         typedef struct statvfs StatFS;</span>
<span id="L817"><span class="lineNum">     817</span>              : #endif</span>
<span id="L818"><span class="lineNum">     818</span>              : #ifdef __LINUX__</span>
<span id="L819"><span class="lineNum">     819</span>              : #define PARTITION_BUFFER_SIZE 1024</span>
<span id="L820"><span class="lineNum">     820</span>              :         static constexpr const TCHAR* MountKey = _T(&quot;mounted on &quot;);</span>
<span id="L821"><span class="lineNum">     821</span>              :         static constexpr const TCHAR* DeviceKey = _T(&quot;device &quot;);</span>
<span id="L822"><span class="lineNum">     822</span>              :         static constexpr const TCHAR* MountStatsFileName = _T(&quot;/proc/self/mountstats&quot;);</span>
<span id="L823"><span class="lineNum">     823</span>              : #endif</span>
<span id="L824"><span class="lineNum">     824</span>              : </span>
<span id="L825"><span class="lineNum">     825</span>              :     public:</span>
<span id="L826"><span class="lineNum">     826</span>              :         Partition() = delete;</span>
<span id="L827"><span class="lineNum">     827</span>              :         Partition(const Partition&amp; copy) = delete;</span>
<span id="L828"><span class="lineNum">     828</span>              :         explicit Partition(const TCHAR path[])</span>
<span id="L829"><span class="lineNum">     829</span>              :             : _size(0)</span>
<span id="L830"><span class="lineNum">     830</span>              :             , _free(0)</span>
<span id="L831"><span class="lineNum">     831</span>              :             , _path(path)</span>
<span id="L832"><span class="lineNum">     832</span>              :         {</span>
<span id="L833"><span class="lineNum">     833</span>              :             LoadPartitionInfo();</span>
<span id="L834"><span class="lineNum">     834</span>              :         }</span>
<span id="L835"><span class="lineNum">     835</span>              :         ~Partition()</span>
<span id="L836"><span class="lineNum">     836</span>              :         {</span>
<span id="L837"><span class="lineNum">     837</span>              :         }</span>
<span id="L838"><span class="lineNum">     838</span>              : </span>
<span id="L839"><span class="lineNum">     839</span>              :     private:</span>
<span id="L840"><span class="lineNum">     840</span>              :         void LoadPartitionInfo();</span>
<span id="L841"><span class="lineNum">     841</span>              :         string RemoveRepeatedPathSeparator(const string&amp; path);</span>
<span id="L842"><span class="lineNum">     842</span>              :         bool ReadPartitionName(const string&amp; fileName, string&amp; device);</span>
<span id="L843"><span class="lineNum">     843</span>              : </span>
<span id="L844"><span class="lineNum">     844</span>              :     public:</span>
<span id="L845"><span class="lineNum">     845</span>              :         uint64_t Size() const</span>
<span id="L846"><span class="lineNum">     846</span>              :         {</span>
<span id="L847"><span class="lineNum">     847</span>              :             return _size;</span>
<span id="L848"><span class="lineNum">     848</span>              :         }</span>
<span id="L849"><span class="lineNum">     849</span>              :         uint64_t Free() const</span>
<span id="L850"><span class="lineNum">     850</span>              :         {</span>
<span id="L851"><span class="lineNum">     851</span>              :             return _free;</span>
<span id="L852"><span class="lineNum">     852</span>              :         }</span>
<span id="L853"><span class="lineNum">     853</span>              :         bool IsValid() const</span>
<span id="L854"><span class="lineNum">     854</span>              :         {</span>
<span id="L855"><span class="lineNum">     855</span>              :             return (_size != 0);</span>
<span id="L856"><span class="lineNum">     856</span>              :         }</span>
<span id="L857"><span class="lineNum">     857</span>              :         string Name() const</span>
<span id="L858"><span class="lineNum">     858</span>              :         {</span>
<span id="L859"><span class="lineNum">     859</span>              :             return _name;</span>
<span id="L860"><span class="lineNum">     860</span>              :         }</span>
<span id="L861"><span class="lineNum">     861</span>              : </span>
<span id="L862"><span class="lineNum">     862</span>              :     private:</span>
<span id="L863"><span class="lineNum">     863</span>              :         uint64_t _size;</span>
<span id="L864"><span class="lineNum">     864</span>              :         uint64_t _free;</span>
<span id="L865"><span class="lineNum">     865</span>              : </span>
<span id="L866"><span class="lineNum">     866</span>              :         string _name;</span>
<span id="L867"><span class="lineNum">     867</span>              :         string _path;</span>
<span id="L868"><span class="lineNum">     868</span>              :     };</span>
<span id="L869"><span class="lineNum">     869</span>              : }</span>
<span id="L870"><span class="lineNum">     870</span>              : } // namespace Core</span>
<span id="L871"><span class="lineNum">     871</span>              : </span>
<span id="L872"><span class="lineNum">     872</span>              : #endif</span>
        </pre>
              </td>
            </tr>
          </table>
          <br>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
            <tr><td class="versionInfo">Generated by: <a href="https://github.com//linux-test-project/lcov" target="_parent">LCOV version 2.0-1</a></td></tr>
          </table>
          <br>

</body>
</html>
