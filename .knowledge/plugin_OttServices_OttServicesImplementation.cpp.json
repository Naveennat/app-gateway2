{"is_source_file": true, "format": "C++", "description": "This file implements the OttServicesImplementation class which provides permission management, token fetching, and authentication metadata collection functionalities for an OTT (over-the-top) service. It includes methods for configuration, initialization, permission retrieval, token generation, and interaction with authentication services.", "external_files": ["OttServicesImplementation.h", "UtilsJsonrpcDirectLink.h", "interfaces/IAuthService.h", "TokenClient.h", "TokenCache.h", "core/Enumerate.h"], "external_methods": ["Core::ERROR_NONE", "Core::ERROR_BAD_REQUEST", "Core::ERROR_UNAVAILABLE", "Core::IWorkerPool::Instance().Submit", "Core::Service<RPC::StringIterator>::Create", "wpeframework::Exchange::IAuthService::GetServiceAccessToken", "wpeframework::Exchange::IAuthService::GetAuthToken", "wpeframework::Exchange::IAuthService::GetSessionToken"], "published": ["GetPartnerId", "GetAccountId", "GetDeviceId", "GetAppCIMAToken", "GetAppThorToken", "UpdatePermissions", "GetAppPermissions"], "classes": [{"name": "OttServicesImplementation", "description": "Class implementing OTT service functionalities such as permission management, token handling, and authentication metadata collection."}], "methods": [{"name": "uint32_t Configure(PluginHost::IShell * shell)", "description": "Configures the service with provided shell.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "string Initialize(PluginHost::IShell * service)", "description": "Initializes the service with configuration parameters.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "void Deinitialize(PluginHost::IShell *)", "description": "Cleans up and releases resources.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "void SetPermissionsClient() const", "description": "Initializes the permissions client.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "void SetTokenClient() const", "description": "Initializes the token client.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "Core::hresult GetPermissionsFromServer(const string & appId,std::vector<std::string> & permissions) const", "description": "Fetches permissions from the server.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "Core::hresult UpdatePermissions(const string & appId,std::vector<std::string> & permissions) const", "description": "Updates permissions cache on a separate thread.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "Core::hresult GetAppPermissions(const string & appId,bool forceNew,Exchange::IOttServices::IStringIterator * & permissions) const", "description": "Retrieves permissions for a specific app, optionally forcing a refresh.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "string GetPartnerId() const", "description": "Reads partner ID from file.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "string GetAccountId() const", "description": "Reads account ID from file.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "string GetDeviceId() const", "description": "Reads device ID from file.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "bool CollectAuthMetadata(std::string & bearerToken,std::string & deviceId,std::string & accountId,std::string & partnerId) const", "description": "Collects authentication metadata including bearer token, device ID, account ID, and partner ID.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "Core::hresult GetAppThorToken(const string & appId,const string & contentProvider,const string & deviceSessionId,const string & appSessionId,string & outToken) const", "description": "Retrieves a Thor token via permission client.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "uint64_t NowEpochSec()", "description": "Returns the current epoch time in seconds.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "bool FetchSat(std::string & sat,uint64_t & expiryEpoch) const", "description": "Fetches SAT token and its expiry from AuthService.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "bool FetchXact(const std::string & appId,std::string & xact,uint64_t & expiryEpoch) const", "description": "Fetches XACT token and its expiry from AuthService.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "bool FetchXsct(std::string & xSCT,uint64_t & expiryEpoch) const", "description": "Fetches XSCT token and its expiry from AuthService.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "Core::hresult GetAppCIMAToken(const string & appId,string & token) const", "description": "Fetches or retrieves from cache a CIMAT (client identity management authentication) token.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "OttServicesImplementation()", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class", "description": "unavailable"}], "calls": ["LOGINFO", "LOGERR", "LOGWARN", "QueryInterfaceByCallsign", "GetServiceAccessToken", "GetAuthToken", "GetSessionToken", "Core::Service<RPC::StringIterator>::Create", "Core::IWorkerPool::Instance().Submit"], "search-terms": ["OttServicesImplementation", "PermissionsClient", "TokenClient", "GetAppCIMAToken", "GetAppThorToken", "CollectAuthMetadata", "AuthService", "Xact", "Xsct", "SAT", "permissions", "TokenCache", "PermissionsEndpoint", "TokenEndpoint", "License", "Rpc", "Authentication"], "state": 2, "file_id": 8764, "knowledge_revision": 17550, "git_revision": "ebc81d5be406b7bad5fd35c44b16992d94834970", "ctags": [{"_type": "tag", "name": "ACCOUNT_ID_FILENAME", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^#define ACCOUNT_ID_FILENAME /", "file": true, "language": "C++", "kind": "macro"}, {"_type": "tag", "name": "CollectAuthMetadata", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    bool OttServicesImplementation::CollectAuthMetadata(std::string& bearerToken,$/", "language": "C++", "typeref": "typename:bool", "kind": "function", "signature": "(std::string & bearerToken,std::string & deviceId,std::string & accountId,std::string & partnerId) const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "Configure", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    uint32_t OttServicesImplementation::Configure(PluginHost::IShell* shell) {$/", "language": "C++", "typeref": "typename:uint32_t", "kind": "function", "signature": "(PluginHost::IShell * shell)", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "DEVICE_ID_FILENAME", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^#define DEVICE_ID_FILENAME /", "file": true, "language": "C++", "kind": "macro"}, {"_type": "tag", "name": "Deinitialize", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    void OttServicesImplementation::Deinitialize(PluginHost::IShell* \\/*service*\\/) {$/", "language": "C++", "typeref": "typename:void", "kind": "function", "signature": "(PluginHost::IShell *)", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "FetchSat", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    bool OttServicesImplementation::FetchSat(std::string& sat, uint64_t& expiryEpoch) const {$/", "language": "C++", "typeref": "typename:bool", "kind": "function", "signature": "(std::string & sat,uint64_t & expiryEpoch) const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "FetchXact", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    bool OttServicesImplementation::FetchXact(const std::string& appId, std::string& xact, uint6/", "language": "C++", "typeref": "typename:bool", "kind": "function", "signature": "(const std::string & appId,std::string & xact,uint64_t & expiryEpoch) const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "FetchXsct", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    bool OttServicesImplementation::FetchXsct(std::string& xSCT, uint64_t& expiryEpoch) const {$/", "language": "C++", "typeref": "typename:bool", "kind": "function", "signature": "(std::string & xSCT,uint64_t & expiryEpoch) const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "GetAccountId", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    string OttServicesImplementation::GetAccountId() const$/", "language": "C++", "typeref": "typename:string", "kind": "function", "signature": "() const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "GetAppCIMAToken", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    Core::hresult OttServicesImplementation::GetAppCIMAToken(const string& appId, string& token)/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId,string & token) const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "GetAppPermissions", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    Core::hresult OttServicesImplementation::GetAppPermissions(const string& appId, bool forceNe/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId,bool forceNew,Exchange::IOttServices::IStringIterator * & permissions) const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "GetAppThorToken", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    Core::hresult OttServicesImplementation::GetAppThorToken(const string& appId,$/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId,const string & contentProvider,const string & deviceSessionId,const string & appSessionId,string & outToken) const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "GetDeviceId", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    string OttServicesImplementation::GetDeviceId() const$/", "language": "C++", "typeref": "typename:string", "kind": "function", "signature": "() const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "GetPartnerId", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    string OttServicesImplementation::GetPartnerId() const$/", "language": "C++", "typeref": "typename:string", "kind": "function", "signature": "() const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "GetPermissionsFromServer", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    Core::hresult OttServicesImplementation::GetPermissionsFromServer(const string& appId, std::/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId,std::vector<std::string> & permissions) const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "Initialize", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    string OttServicesImplementation::Initialize(PluginHost::IShell* service) {$/", "language": "C++", "typeref": "typename:string", "kind": "function", "signature": "(PluginHost::IShell * service)", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "NowEpochSec", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    uint64_t OttServicesImplementation::NowEpochSec() {$/", "language": "C++", "typeref": "typename:uint64_t", "kind": "function", "signature": "()", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "OttServicesImplementation", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    OttServicesImplementation::OttServicesImplementation()$/", "language": "C++", "kind": "function", "signature": "()", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "PARTNER_ID_FILENAME", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^#define PARTNER_ID_FILENAME /", "file": true, "language": "C++", "kind": "macro"}, {"_type": "tag", "name": "Plugin", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^namespace Plugin {$/", "file": true, "language": "C++", "kind": "namespace", "scope": "WPEFramework", "scopeKind": "namespace"}, {"_type": "tag", "name": "SetPermissionsClient", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    void OttServicesImplementation::SetPermissionsClient() const {$/", "language": "C++", "typeref": "typename:void", "kind": "function", "signature": "() const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "SetTokenClient", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    void OttServicesImplementation::SetTokenClient() const {$/", "language": "C++", "typeref": "typename:void", "kind": "function", "signature": "() const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "UpdatePermissions", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    Core::hresult OttServicesImplementation::UpdatePermissions(const string& appId, std::vector</", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId,std::vector<std::string> & permissions) const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "WPEFramework", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^namespace WPEFramework {$/", "file": true, "language": "C++", "kind": "namespace"}, {"_type": "tag", "name": "__anon684183630111", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^    namespace {$/", "file": true, "language": "C++", "kind": "namespace", "scope": "WPEFramework::Plugin", "scopeKind": "namespace"}, {"_type": "tag", "name": "kAuthServiceCallsign", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^        static constexpr const char* kAuthServiceCallsign = \"org.rdk.AuthService\";$/", "file": true, "language": "C++", "typeref": "typename:const char *", "kind": "variable", "scope": "WPEFramework::Plugin::__anon684183630111", "scopeKind": "namespace"}, {"_type": "tag", "name": "kDefaultPermsEndpoint", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^        static constexpr const char* kDefaultPermsEndpoint = \"thor-permission.svc.thor.comcast.c/", "file": true, "language": "C++", "typeref": "typename:const char *", "kind": "variable", "scope": "WPEFramework::Plugin::__anon684183630111", "scopeKind": "namespace"}, {"_type": "tag", "name": "kDefaultTokenEndpoint", "path": "/home/kavia/workspace/code-generation/app-gateway2/plugin/OttServices/OttServicesImplementation.cpp", "pattern": "/^        static constexpr const char* kDefaultTokenEndpoint = \"ott-token-service.svc.thor.comcast/", "file": true, "language": "C++", "typeref": "typename:const char *", "kind": "variable", "scope": "WPEFramework::Plugin::__anon684183630111", "scopeKind": "namespace"}], "hash": "ac48414cfd46af71227586d2dbc99142", "format-version": 4, "code-base-name": "app-gateway2", "filename": "plugin/OttServices/OttServicesImplementation.cpp", "fields": [{"name": "const char * kAuthServiceCallsign", "scope": "WPEFramework::Plugin::__anon684183630111", "scopeKind": "namespace", "description": "unavailable"}, {"name": "const char * kDefaultPermsEndpoint", "scope": "WPEFramework::Plugin::__anon684183630111", "scopeKind": "namespace", "description": "unavailable"}, {"name": "const char * kDefaultTokenEndpoint", "scope": "WPEFramework::Plugin::__anon684183630111", "scopeKind": "namespace", "description": "unavailable"}], "revision_history": [{"17550": "ebc81d5be406b7bad5fd35c44b16992d94834970"}]}