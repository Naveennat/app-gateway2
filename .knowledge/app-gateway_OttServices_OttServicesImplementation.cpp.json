{"is_source_file": true, "format": "C++", "description": "This file implements the OttServices class, providing permission management, token fetching, and authentication metadata collection for OTT services. It interacts with several external components such as permissions clients, token clients, and an AuthService interface via RPC. The code includes initialization, deinitialization, permission cache updates, and token retrieval functions.", "external_files": ["OttServicesImplementation.h", "core/Enumerate.h", "UtilsLogging.h", "OttPermissionCache.h", "UtilsJsonrpcDirectLink.h", "TokenClient.h", "TokenCache.h"], "external_methods": ["Utils::GetThunderControllerClient", "JsonObject::Invoke", "OttPermissionCache::Instance", "PermissionsClient::EnumeratePermissions", "PermissionsClient::Endpoint"], "published": ["Ping", "GetPermissions", "InvalidatePermissions", "UpdatePermissionsCache", "GetDistributorToken", "GetAuthToken"], "classes": [{"name": "OttServicesImplementation", "description": "Implements the core functionality for OTT services, including permission caching, token management, and communication with an AuthService."}], "methods": [{"name": "uint32_t Configure(PluginHost::IShell * shell)", "description": "Sets up the service with the provided shell, calling Initialize internally.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "string Initialize(PluginHost::IShell * service)", "description": "Loads configuration parameters and initializes permissions and token clients.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "void Deinitialize(PluginHost::IShell *)", "description": "Cleans up resources and resets service state.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "Core::hresult Ping(const string & message,string & reply)", "description": "Simple health check method responding with 'pong'.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "Core::hresult GetPermissions(const string & appId,std::vector<string> & permissionsOut)", "description": "Retrieves permissions for a specified appId, either as a vector or JSON string.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "Core::hresult InvalidatePermissions(const string & appId)", "description": "Invalidates permissions cache for a specific appId.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "bool CollectAuthMetadata(std::string & bearerToken,std::string & deviceId,std::string & accountId,std::string & partnerId) const", "description": "Collects authentication tokens and IDs from the AuthService via RPC.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "Core::hresult UpdatePermissionsCache(const string & appId,uint32_t & updatedCount)", "description": "Fetches and caches permissions for an application based on authentication metadata.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "uint64_t NowEpochSec()", "description": "Returns the current epoch time in seconds.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "bool FetchSat(std::string & sat,uint64_t & expiryEpoch) const", "description": "Fetches the platform's service access token (SAT) from the AuthService.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "bool FetchXact(const std::string & appId,std::string & xact,uint64_t & expiryEpoch) const", "description": "Fetches the XACT token with associated expiry for a given application ID.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "Core::hresult GetDistributorToken(const string & appId,string & token)", "description": "Retrieves or caches a distributed platform token for an appId.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "Core::hresult GetAuthToken(const string & appId,string & token)", "description": "Retrieves or caches an authentication token for an appId.", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"name": "Core::hresult GetPermissions(const string & appId,string & permissionsJson)", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class", "description": "unavailable"}, {"name": "OttServicesImplementation()", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class", "description": "unavailable"}], "calls": ["Utils::GetThunderControllerClient", "JsonObject::Invoke", "OttPermissionCache::Instance", "PermissionsClient::EnumeratePermissions", "PermissionsClient::Endpoint"], "search-terms": ["OttServicesImplementation", "PermissionsCache", "TokenClient", "AuthService", "PermissionsEndpoint", "GetDistributorToken", "FetchSat", "FetchXact"], "state": 2, "file_id": 51, "knowledge_revision": 16356, "git_revision": "1f23fbe26b359ee5c126908b69c4add2183a3338", "revision_history": [{"160": ""}, {"174": "0122b584310d777b8d07f9a9be695f2cb90c09dd"}, {"175": "0122b584310d777b8d07f9a9be695f2cb90c09dd"}, {"176": "0122b584310d777b8d07f9a9be695f2cb90c09dd"}, {"177": "0122b584310d777b8d07f9a9be695f2cb90c09dd"}, {"178": "0122b584310d777b8d07f9a9be695f2cb90c09dd"}, {"192": "c8e47b2a6d37c6d5c56d0ecafffe3d8cbec64b9e"}, {"242": "648fe4facac7e3617f078e1af2f5ab5734b54229"}, {"246": "b0e01aa51ae6843a5d01bbae74faf0038a2e4a91"}, {"254": "b0e01aa51ae6843a5d01bbae74faf0038a2e4a91"}, {"259": "b980f4e3e253a8299a669f5f0622cb22913a253d"}, {"295": "b980f4e3e253a8299a669f5f0622cb22913a253d"}, {"328": "a7a470609e5ec86bfb827285d49e4d69ba63ed5b"}, {"413": "ee01dfa922d65deb1655acc4f9ef7a881f6c3e05"}, {"433": "2bdba5cf8c479e9a9dab6c131daae4d58f0bd734"}, {"437": "2bdba5cf8c479e9a9dab6c131daae4d58f0bd734"}, {"16327": "0f87a35b32215bc8547fb583d6c84bd51f603f69"}, {"16343": "fff39b943f272d7b49d7be5a37a891e7a3c0e2ea"}, {"16347": "fff39b943f272d7b49d7be5a37a891e7a3c0e2ea"}, {"16350": "1f23fbe26b359ee5c126908b69c4add2183a3338"}, {"16356": "1f23fbe26b359ee5c126908b69c4add2183a3338"}], "ctags": [{"_type": "tag", "name": "CollectAuthMetadata", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    bool OttServicesImplementation::CollectAuthMetadata(std::string& bearerToken,$/", "language": "C++", "typeref": "typename:bool", "kind": "function", "signature": "(std::string & bearerToken,std::string & deviceId,std::string & accountId,std::string & partnerId) const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "Configure", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    uint32_t OttServicesImplementation::Configure(PluginHost::IShell* shell) {$/", "language": "C++", "typeref": "typename:uint32_t", "kind": "function", "signature": "(PluginHost::IShell * shell)", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "Deinitialize", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    void OttServicesImplementation::Deinitialize(PluginHost::IShell* \\/*service*\\/) {$/", "language": "C++", "typeref": "typename:void", "kind": "function", "signature": "(PluginHost::IShell *)", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "FetchSat", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    bool OttServicesImplementation::FetchSat(std::string& sat, uint64_t& expiryEpoch) const {$/", "language": "C++", "typeref": "typename:bool", "kind": "function", "signature": "(std::string & sat,uint64_t & expiryEpoch) const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "FetchXact", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    bool OttServicesImplementation::FetchXact(const std::string& appId, std::string& xact, uint6/", "language": "C++", "typeref": "typename:bool", "kind": "function", "signature": "(const std::string & appId,std::string & xact,uint64_t & expiryEpoch) const", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "GetAuthToken", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    Core::hresult OttServicesImplementation::GetAuthToken(const string& appId,$/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId,string & token)", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "GetDistributorToken", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    Core::hresult OttServicesImplementation::GetDistributorToken(const string& appId,$/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId,string & token)", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "GetPermissions", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    Core::hresult OttServicesImplementation::GetPermissions(const string& appId, std::vector<str/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId,std::vector<string> & permissionsOut)", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "GetPermissions", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    Core::hresult OttServicesImplementation::GetPermissions(const string& appId, string& permiss/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId,string & permissionsJson)", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "Initialize", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    string OttServicesImplementation::Initialize(PluginHost::IShell* service) {$/", "language": "C++", "typeref": "typename:string", "kind": "function", "signature": "(PluginHost::IShell * service)", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "InvalidatePermissions", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    Core::hresult OttServicesImplementation::InvalidatePermissions(const string& appId) {$/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId)", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "NowEpochSec", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    uint64_t OttServicesImplementation::NowEpochSec() {$/", "language": "C++", "typeref": "typename:uint64_t", "kind": "function", "signature": "()", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "OttServicesImplementation", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    OttServicesImplementation::OttServicesImplementation()$/", "language": "C++", "kind": "function", "signature": "()", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "Ping", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    Core::hresult OttServicesImplementation::Ping(const string& message, string& reply) {$/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & message,string & reply)", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "Plugin", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^namespace Plugin {$/", "file": true, "language": "C++", "kind": "namespace", "scope": "WPEFramework", "scopeKind": "namespace"}, {"_type": "tag", "name": "UpdatePermissionsCache", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    Core::hresult OttServicesImplementation::UpdatePermissionsCache(const string& appId, uint32_/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId,uint32_t & updatedCount)", "scope": "WPEFramework::Plugin::OttServicesImplementation", "scopeKind": "class"}, {"_type": "tag", "name": "WPEFramework", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^namespace WPEFramework {$/", "file": true, "language": "C++", "kind": "namespace"}, {"_type": "tag", "name": "__anonef41e7940111", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^    namespace {$/", "file": true, "language": "C++", "kind": "namespace", "scope": "WPEFramework::Plugin", "scopeKind": "namespace"}, {"_type": "tag", "name": "kAuthServiceCallsign", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^        static constexpr const char* kAuthServiceCallsign = \"org.rdk.AuthService\";$/", "file": true, "language": "C++", "typeref": "typename:const char *", "kind": "variable", "scope": "WPEFramework::Plugin::__anonef41e7940111", "scopeKind": "namespace"}, {"_type": "tag", "name": "kDefaultPermsEndpoint", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^        static constexpr const char* kDefaultPermsEndpoint = \"thor-permission.svc.thor.comcast.c/", "file": true, "language": "C++", "typeref": "typename:const char *", "kind": "variable", "scope": "WPEFramework::Plugin::__anonef41e7940111", "scopeKind": "namespace"}, {"_type": "tag", "name": "kDefaultTokenEndpoint", "path": "/home/kavia/workspace/code-generation/app-gateway2/app-gateway/OttServices/OttServicesImplementation.cpp", "pattern": "/^        static constexpr const char* kDefaultTokenEndpoint = kDefaultPermsEndpoint; \\/\\/ fallbac/", "file": true, "language": "C++", "typeref": "typename:const char *", "kind": "variable", "scope": "WPEFramework::Plugin::__anonef41e7940111", "scopeKind": "namespace"}], "hash": "85b191e12897c237120a67355b3ac574", "format-version": 4, "code-base-name": "app-gateway2", "filename": "app-gateway/OttServices/OttServicesImplementation.cpp", "fields": [{"name": "const char * kAuthServiceCallsign", "scope": "WPEFramework::Plugin::__anonef41e7940111", "scopeKind": "namespace", "description": "unavailable"}, {"name": "const char * kDefaultPermsEndpoint", "scope": "WPEFramework::Plugin::__anonef41e7940111", "scopeKind": "namespace", "description": "unavailable"}, {"name": "const char * kDefaultTokenEndpoint", "scope": "WPEFramework::Plugin::__anonef41e7940111", "scopeKind": "namespace", "description": "unavailable"}]}