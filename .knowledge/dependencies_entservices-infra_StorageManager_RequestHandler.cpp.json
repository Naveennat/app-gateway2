{"is_source_file": true, "format": "C++", "description": "This source file implements the RequestHandler class for managing storage directories and quotas in a plugin-based environment. It includes methods for creating, retrieving, and deleting app storage, managing persistent store objects, and calculating directory sizes, with thread-safe mechanisms and filesystem operations.", "external_files": ["RequestHandler.h", "UtilsLogging.h", "<interfaces/IStore2.h>", "<sys/statvfs.h>"], "external_methods": ["core::ERROR_GENERAL", "core::ERROR_NONE", "core::hresult", "core::ERROR_GENERAL", "core::ERROR_NONE", "core::ERROR_GENERAL", "core::ERROR_NONE", "Core::hresult", "Core::ERROR_GENERAL", "Core::ERROR_NONE", "core::ERROR_GENERAL", "core::ERROR_NONE", "Core::hresult", "std::move", "isValidAppStorageDirectory", "appQuotaSizeProperty", "getDirectorySizeInBytes", "createAppStorageInfoByAppID", "removeAppStorageInfoByAppID", "access", "mkdir", "rmdir", "opendir", "readdir", "closedir", "nftw", "unlink", "rmdir", "strerror", "chown", "std::find", "JsonObject::FromString", "JsonObject::HasLabel", "JsonObject["], "published": ["RequestHandler::getInstance", "RequestHandler::populateAppInfoCacheFromStoragePath", "RequestHandler::createPersistentStoreRemoteStoreObject", "RequestHandler::releasePersistentStoreRemoteStoreObject", "RequestHandler::isValidAppStorageDirectory", "RequestHandler::appQuotaSizeProperty", "RequestHandler::getSize", "RequestHandler::getDirectorySizeInBytes", "RequestHandler::createAppStorageInfoByAppID", "RequestHandler::retrieveAppStorageInfoByAppID", "RequestHandler::removeAppStorageInfoByAppID", "RequestHandler::hasEnoughStorageFreeSpace", "RequestHandler::CreateStorage", "RequestHandler::GetStorage", "RequestHandler::DeleteStorage", "RequestHandler::deleteCallback", "RequestHandler::deleteDirectoryEntries", "RequestHandler::lockAppStorageInfo", "RequestHandler::Clear", "RequestHandler::ClearAll", "RequestHandler::SetBaseStoragePath"], "classes": [{"name": "RequestHandler", "description": "Manages application storage directories, quotas, and persistent store interactions; provides APIs for creating, retrieving, and deleting storage, ensuring thread safety, and calculating directory sizes."}], "methods": [{"name": "RequestHandler & getInstance()", "description": "Provides singleton access to the RequestHandler instance.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "Core::hresult populateAppInfoCacheFromStoragePath()", "description": "Scans the base storage directory to populate internal app storage info map.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "Core::hresult createPersistentStoreRemoteStoreObject()", "description": "Creates the persistent store interface object for storage operations.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "void releasePersistentStoreRemoteStoreObject()", "description": "Releases the persistent store object resource.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "bool isValidAppStorageDirectory(const std::string & dirName)", "description": "Validates if the directory name conforms to app ID rules.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "Core::hresult appQuotaSizeProperty(RequestHandler::StorageActionType actionType,const std::string & appId,uint32_t * quotaValue)", "description": "Gets, sets, or deletes the quota size property for a specific app via persistent store.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "int getSize(const char * path,const struct stat * statPtr,int currentFlag,struct FTW * internalFtwUsage)", "description": "A callback for nftw to accumulate file sizes for directory size calculations.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "uint64_t getDirectorySizeInBytes(const std::string & path)", "description": "Computes total size of a directory recursively.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "bool createAppStorageInfoByAppID(const std::string & appId,StorageAppInfo & storageInfo)", "description": "Adds or updates storage info for a given app in the internal map.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "bool retrieveAppStorageInfoByAppID(const string & appId,StorageAppInfo & storageInfo)", "description": "Retrieves storage information for the app, updating used size.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "bool removeAppStorageInfoByAppID(const string & appId)", "description": "Removes the app's storage info from internal map and persistent store.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "bool hasEnoughStorageFreeSpace(const std::string & baseDir,uint32_t requiredSpaceKB)", "description": "Checks if sufficient free space exists for a new app storage requirement.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "Core::hresult CreateStorage(const std::string & appId,const uint32_t & size,std::string & path,std::string & errorReason)", "description": "Creates storage directory for an app, ensuring quota and space are available.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "Core::hresult GetStorage(const string & appId,const int32_t & userId,const int32_t & groupId,string & path,uint32_t & size,uint32_t & used)", "description": "Retrieves storage info and optionally updates ownership.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "Core::hresult DeleteStorage(const string & appId,string & errorReason)", "description": "Deletes an app's storage directory and info from map.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "int deleteCallback(const char * path,const struct stat * sb,int typeflag,struct FTW * ftwbuf)", "description": "NFTW callback to delete files and directories.", "scope": "WPEFramework::Plugin", "scopeKind": "namespace"}, {"name": "Core::hresult deleteDirectoryEntries(const string & appId,string & errorReason)", "description": "Deletes all entries within a directory, used for cleaning app storage.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "bool lockAppStorageInfo(const std::string & appId,std::unique_lock<std::mutex> & appLock)", "description": "Thread-safely locks storage info for a specific app.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "Core::hresult Clear(const string & appId,string & errorReason)", "description": "Clears storage for a specific app.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "Core::hresult ClearAll(const string & exemptionAppIds,string & errorReason)", "description": "Clears storage for all apps except those exempted.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "void SetBaseStoragePath(const std::string & path)", "description": "Sets the root path for all app storage.", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"name": "RequestHandler()", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class", "description": "unavailable"}, {"name": "void setCurrentService(PluginHost::IShell * service)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class", "description": "unavailable"}, {"name": "~RequestHandler()", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class", "description": "unavailable"}], "calls": ["opendir", "readdir", "closedir", "stat", "mkdir", "rmdir", "nftw", "unlink", "strerror", "chown", "std::find", "access"], "search-terms": ["RequestHandler", "populateAppInfoCacheFromStoragePath", "appQuotaSizeProperty", "getDirectorySizeInBytes", "createAppStorageInfoByAppID", "hasEnoughStorageFreeSpace", "CreateStorage", "GetStorage", "DeleteStorage", "deleteCallback", "storageAppInfo", "PersistentStore"], "state": 2, "file_id": 218, "knowledge_revision": 1332, "git_revision": "", "ctags": [{"_type": "tag", "name": "Clear", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        Core::hresult RequestHandler::Clear(const string& appId, string& errorReason)$/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId,string & errorReason)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "ClearAll", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        Core::hresult RequestHandler::ClearAll(const string& exemptionAppIds, string& errorReaso/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & exemptionAppIds,string & errorReason)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "CreateStorage", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        Core::hresult RequestHandler::CreateStorage(const std::string& appId, const uint32_t& si/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const std::string & appId,const uint32_t & size,std::string & path,std::string & errorReason)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "DEFAULT_STORAGE_DEV_BLOCK_SIZE", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^#define DEFAULT_STORAGE_DEV_BLOCK_SIZE /", "file": true, "language": "C++", "kind": "macro"}, {"_type": "tag", "name": "DeleteStorage", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        Core::hresult RequestHandler::DeleteStorage(const string& appId, string& errorReason)$/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId,string & errorReason)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "GetStorage", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        Core::hresult RequestHandler::GetStorage(const string& appId, const int32_t& userId, con/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId,const int32_t & userId,const int32_t & groupId,string & path,uint32_t & size,uint32_t & used)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "MAX_NUM_OF_FILE_DESCRIPTORS", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^#define MAX_NUM_OF_FILE_DESCRIPTORS /", "file": true, "language": "C++", "kind": "macro"}, {"_type": "tag", "name": "Plugin", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^    namespace Plugin$/", "file": true, "language": "C++", "kind": "namespace", "scope": "WPEFramework", "scopeKind": "namespace"}, {"_type": "tag", "name": "RequestHandler", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        RequestHandler::RequestHandler(): mService(nullptr)$/", "language": "C++", "kind": "function", "signature": "()", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "STORAGE_DIR_PERMISSION", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^#define STORAGE_DIR_PERMISSION /", "file": true, "language": "C++", "kind": "macro"}, {"_type": "tag", "name": "SetBaseStoragePath", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        void RequestHandler::SetBaseStoragePath(const std::string& path)$/", "language": "C++", "typeref": "typename:void", "kind": "function", "signature": "(const std::string & path)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "WPEFramework", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^namespace WPEFramework$/", "file": true, "language": "C++", "kind": "namespace"}, {"_type": "tag", "name": "appQuotaSizeProperty", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        Core::hresult RequestHandler::appQuotaSizeProperty(RequestHandler::StorageActionType act/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(RequestHandler::StorageActionType actionType,const std::string & appId,uint32_t * quotaValue)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "createAppStorageInfoByAppID", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        bool RequestHandler::createAppStorageInfoByAppID(const std::string& appId, StorageAppInf/", "language": "C++", "typeref": "typename:bool", "kind": "function", "signature": "(const std::string & appId,StorageAppInfo & storageInfo)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "createPersistentStoreRemoteStoreObject", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        Core::hresult RequestHandler::createPersistentStoreRemoteStoreObject()$/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "()", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "deleteCallback", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        int deleteCallback(const char *path, const struct stat *sb, int typeflag, struct FTW *ft/", "language": "C++", "typeref": "typename:int", "kind": "function", "signature": "(const char * path,const struct stat * sb,int typeflag,struct FTW * ftwbuf)", "scope": "WPEFramework::Plugin", "scopeKind": "namespace"}, {"_type": "tag", "name": "deleteDirectoryEntries", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        Core::hresult RequestHandler::deleteDirectoryEntries(const string& appId, string& errorR/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "(const string & appId,string & errorReason)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "gStorageSize", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        static RequestHandler::StorageSize gStorageSize;$/", "file": true, "language": "C++", "typeref": "typename:RequestHandler::StorageSize", "kind": "variable", "scope": "WPEFramework::Plugin", "scopeKind": "namespace"}, {"_type": "tag", "name": "getDirectorySizeInBytes", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        uint64_t RequestHandler::getDirectorySizeInBytes(const std::string &path)$/", "language": "C++", "typeref": "typename:uint64_t", "kind": "function", "signature": "(const std::string & path)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "getInstance", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        RequestHandler& RequestHandler::getInstance()$/", "language": "C++", "typeref": "typename:RequestHandler &", "kind": "function", "signature": "()", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "getSize", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        int RequestHandler::getSize(const char *path, const struct stat *statPtr, int currentFla/", "language": "C++", "typeref": "typename:int", "kind": "function", "signature": "(const char * path,const struct stat * statPtr,int currentFlag,struct FTW * internalFtwUsage)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "hasEnoughStorageFreeSpace", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        bool RequestHandler::hasEnoughStorageFreeSpace(const std::string& baseDir, uint32_t requ/", "language": "C++", "typeref": "typename:bool", "kind": "function", "signature": "(const std::string & baseDir,uint32_t requiredSpaceKB)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "isValidAppStorageDirectory", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        bool RequestHandler::isValidAppStorageDirectory(const std::string& dirName)$/", "language": "C++", "typeref": "typename:bool", "kind": "function", "signature": "(const std::string & dirName)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "lockAppStorageInfo", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        bool RequestHandler::lockAppStorageInfo(const std::string& appId, std::unique_lock<std::/", "language": "C++", "typeref": "typename:bool", "kind": "function", "signature": "(const std::string & appId,std::unique_lock<std::mutex> & appLock)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "mInstanceMutex", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        std::mutex mInstanceMutex;$/", "language": "C++", "typeref": "typename:std::mutex", "kind": "variable", "scope": "WPEFramework::Plugin", "scopeKind": "namespace"}, {"_type": "tag", "name": "mStorageSizeLock", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        std::mutex RequestHandler::mStorageSizeLock;$/", "language": "C++", "typeref": "typename:std::mutex", "kind": "member", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "populateAppInfoCacheFromStoragePath", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        Core::hresult RequestHandler::populateAppInfoCacheFromStoragePath()$/", "language": "C++", "typeref": "typename:Core::hresult", "kind": "function", "signature": "()", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "releasePersistentStoreRemoteStoreObject", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        void RequestHandler::releasePersistentStoreRemoteStoreObject()$/", "language": "C++", "typeref": "typename:void", "kind": "function", "signature": "()", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "removeAppStorageInfoByAppID", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        bool RequestHandler::removeAppStorageInfoByAppID(const string &appId)$/", "language": "C++", "typeref": "typename:bool", "kind": "function", "signature": "(const string & appId)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "retrieveAppStorageInfoByAppID", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        bool RequestHandler::retrieveAppStorageInfoByAppID(const string &appId, StorageAppInfo &/", "language": "C++", "typeref": "typename:bool", "kind": "function", "signature": "(const string & appId,StorageAppInfo & storageInfo)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "setCurrentService", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        void RequestHandler::setCurrentService(PluginHost::IShell* service)$/", "language": "C++", "typeref": "typename:void", "kind": "function", "signature": "(PluginHost::IShell * service)", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}, {"_type": "tag", "name": "~RequestHandler", "path": "/home/kavia/workspace/code-generation/app-gateway2/dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "pattern": "/^        RequestHandler::~RequestHandler()$/", "language": "C++", "kind": "function", "signature": "()", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class"}], "hash": "4f3b453d96d5f1dfc1722d108820c137", "format-version": 4, "code-base-name": "app-gateway2", "filename": "dependencies/entservices-infra/StorageManager/RequestHandler.cpp", "fields": [{"name": "RequestHandler::StorageSize gStorageSize", "scope": "WPEFramework::Plugin", "scopeKind": "namespace", "description": "unavailable"}, {"name": "std::mutex mInstanceMutex", "scope": "WPEFramework::Plugin", "scopeKind": "namespace", "description": "unavailable"}, {"name": "std::mutex mStorageSizeLock", "scope": "WPEFramework::Plugin::RequestHandler", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"1332": ""}]}